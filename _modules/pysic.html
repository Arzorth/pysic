

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pysic &mdash; Pysic 0.4.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Pysic 0.4.3 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Pysic 0.4.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pysic</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;The main module of Pysic.</span>
<span class="sd">    </span>
<span class="sd">This module defines the user interface in Pysic for setting up potentials</span>
<span class="sd">and calculators.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">pysic_fortran</span> <span class="kn">as</span> <span class="nn">pf</span>
<span class="kn">import</span> <span class="nn">pysic_utility</span> <span class="kn">as</span> <span class="nn">pu</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">ase.calculators.neighborlist</span> <span class="kn">as</span> <span class="nn">nbl</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="kn">as</span> <span class="nn">rnd</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">debug</span> <span class="kn">as</span> <span class="nn">d</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">version</span> <span class="o">=</span> <span class="s">&#39;0.4.3&#39;</span>
<span class="sd">&quot;&quot;&quot;program version&quot;&quot;&quot;</span>

<span class="c">#</span>
<span class="c"># PySiC : Pythonic Simulation Code</span>
<span class="c">#</span>
<span class="c"># Teemu Hynninen 2011</span>
<span class="c">#</span>
<span class="c"># pysic.py is the main interface module of Pysic.</span>
<span class="c"># The module contains methods allowing the user</span>
<span class="c"># to interface with the rest of the simulation tools.</span>
<span class="c">#</span>
<span class="c"># The module defines potentials and a calculator class</span>
<span class="c"># ready to be used with the ASE simulation package.</span>
<span class="c"># </span>


<div class="viewcode-block" id="InvalidPotentialError"><a class="viewcode-back" href="../pysic.html#pysic.InvalidPotentialError">[docs]</a><span class="k">class</span> <span class="nc">InvalidPotentialError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when an invalid potential is about to be created or used.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    potential: :class:`~pysic.Potential`</span>
<span class="sd">        the errorneous potential</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">potential</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messsage</span> <span class="o">+</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s"> the Potential: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="InvalidCoordinatorError"><a class="viewcode-back" href="../pysic.html#pysic.InvalidCoordinatorError">[docs]</a><span class="k">class</span> <span class="nc">InvalidCoordinatorError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when an invalid coordination calculator is about to be created or used.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    coordinator: :class:`~pysic.Coordinator`</span>
<span class="sd">        the errorneous coordinator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">coordinator</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">=</span> <span class="n">coordinator</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messsage</span> <span class="o">+</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">  the Coordinator: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="InvalidParametersError"><a class="viewcode-back" href="../pysic.html#pysic.InvalidParametersError">[docs]</a><span class="k">class</span> <span class="nc">InvalidParametersError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when an invalid set of parameters is about to be created.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    params: :class:`~pysic.BondOrderParameters`</span>
<span class="sd">        the errorneous parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messsage</span> <span class="o">+</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">  the Parameters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>


</div>
<span class="k">class</span> <span class="nc">InvalidRelaxationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when an invalid charge relaxation is about to be created.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        message: string</span>
<span class="sd">            information describing why the error occurred</span>
<span class="sd">        params: :class:`~pysic.ChargeRelaxation`</span>
<span class="sd">            the errorneous parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">relaxation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span> <span class="o">=</span> <span class="n">relaxation</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messsage</span> <span class="o">+</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">  the Relaxation: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span><span class="p">)</span>




<div class="viewcode-block" id="MissingAtomsError"><a class="viewcode-back" href="../pysic.html#pysic.MissingAtomsError">[docs]</a><span class="k">class</span> <span class="nc">MissingAtomsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when the core is being updated with per atom information before updating the atoms.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>

    </div>
<div class="viewcode-block" id="MissingNeighborsError"><a class="viewcode-back" href="../pysic.html#pysic.MissingNeighborsError">[docs]</a><span class="k">class</span> <span class="nc">MissingNeighborsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when a calculation is initiated without initializing the neighbor lists.</span>

<span class="sd">    In principle :class:`~pysic.Pysic` should always take care of handling the neighbors automatically.</span>
<span class="sd">    This error is an indication that there is loophole in the built-in preparations.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
</div>
<div class="viewcode-block" id="LockedCoreError"><a class="viewcode-back" href="../pysic.html#pysic.LockedCoreError">[docs]</a><span class="k">class</span> <span class="nc">LockedCoreError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error raised when a :class:`~pysic.Pysic` tries to access the core which is locked</span>
<span class="sd">    by another calculator.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    message: string</span>
<span class="sd">        information describing why the error occurred</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>


<span class="c"># !!!: automatic initialization functions</span>

<span class="c"># Below are general methods for accessing information about the built-in potentials.</span>
<span class="c"># Note that the methods directly inquire the Fortran core, and thus all changes made</span>
<span class="c"># to the core should automatically be taken into account, as long as the proper</span>
<span class="c"># arrays are updated in Potentials.f90</span>

<span class="c"># automatically call the initialization routine in Potentials.f90</span></div>
<span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">start_potentials</span><span class="p">()</span>
<span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">start_bond_order_factors</span><span class="p">()</span>

<span class="c"># automatically initialize mpi - fortran side decides if we really are in mpi</span>
<span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">start_mpi</span><span class="p">()</span>

<span class="c"># automatically initialize the fortran rng</span>
<span class="c"># it needs to be possible to force a seed by the user - to be implemented</span>
<span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">start_rng</span><span class="p">(</span><span class="mi">5301</span><span class="p">)</span><span class="c">#rnd.randint(1, 999999))</span>


<div class="viewcode-block" id="finish_mpi"><a class="viewcode-back" href="../pysic.html#pysic.finish_mpi">[docs]</a><span class="k">def</span> <span class="nf">finish_mpi</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Terminates the MPI framework.</span>

<span class="sd">    If the Fortran core is compiled in MPI mode, :mod:`~pysic` will automatically</span>
<span class="sd">    initialize MPI upon being imported. As the environment won&#39;t know</span>
<span class="sd">    when the user is done with his simulation, terminating the MPI is</span>
<span class="sd">    left as a manual operation. If one terminates Python running :mod:`~pysic`</span>
<span class="sd">    without finishing the MPI first, the MPI framework in the Fortran core will</span>
<span class="sd">    print an error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">finish_mpi</span><span class="p">()</span>

</div>
<span class="k">def</span> <span class="nf">sync_mpi</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calls MPI barrier from the Fortran core MPI framework.&quot;&quot;&quot;</span>

    <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">sync_mpi</span><span class="p">()</span>

<div class="viewcode-block" id="get_number_of_cpus"><a class="viewcode-back" href="../pysic.html#pysic.get_number_of_cpus">[docs]</a><span class="k">def</span> <span class="nf">get_number_of_cpus</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Gets the number of cpus from the Fortran MPI.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_cpus</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="get_cpu_id"><a class="viewcode-back" href="../pysic.html#pysic.get_cpu_id">[docs]</a><span class="k">def</span> <span class="nf">get_cpu_id</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Gets the cpu ID from the Fortran MPI.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_cpu_id</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="list_potentials"><a class="viewcode-back" href="../pysic.html#pysic.list_potentials">[docs]</a><span class="k">def</span> <span class="nf">list_potentials</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.list_valid_potentials`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">list_valid_potentials</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="list_valid_potentials"><a class="viewcode-back" href="../pysic.html#pysic.list_valid_potentials">[docs]</a><span class="k">def</span> <span class="nf">list_valid_potentials</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A list of names of potentials currently known by the core.</span>

<span class="sd">    The method retrieves from the core a list of the names of different potentials</span>
<span class="sd">    currently implemented. Since the fortran core is directly accessed, any</span>
<span class="sd">    updates made in the core source code should get noticed automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_pots</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_potentials</span><span class="p">()</span>
    <span class="n">pot_codes</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">list_valid_potentials</span><span class="p">(</span><span class="n">n_pots</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">pot_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">pot_codes</span><span class="p">:</span>
        <span class="n">pot_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">pot_names</span>

</div>
<div class="viewcode-block" id="list_bond_order_factors"><a class="viewcode-back" href="../pysic.html#pysic.list_bond_order_factors">[docs]</a><span class="k">def</span> <span class="nf">list_bond_order_factors</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.list_valid_bond_order_factors`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">list_valid_bond_order_factors</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="list_valid_bond_order_factors"><a class="viewcode-back" href="../pysic.html#pysic.list_valid_bond_order_factors">[docs]</a><span class="k">def</span> <span class="nf">list_valid_bond_order_factors</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A list of names of bond order factors currently known by the core.</span>

<span class="sd">    The method retrieves from the core a list of the names of different bond factors</span>
<span class="sd">    currently implemented. Since the fortran core is directly accessed, any</span>
<span class="sd">    updates made in the core source code should get noticed automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_bonds</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_bond_order_factors</span><span class="p">()</span>
    <span class="n">bond_codes</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">list_valid_bond_order_factors</span><span class="p">(</span><span class="n">n_bonds</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">bond_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">bond_codes</span><span class="p">:</span>
        <span class="n">bond_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bond_names</span>

</div>
<div class="viewcode-block" id="is_potential"><a class="viewcode-back" href="../pysic.html#pysic.is_potential">[docs]</a><span class="k">def</span> <span class="nf">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.is_valid_potential`</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="is_valid_potential"><a class="viewcode-back" href="../pysic.html#pysic.is_valid_potential">[docs]</a><span class="k">def</span> <span class="nf">is_valid_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells if the given string is the name of a potential.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_bond_order_factor"><a class="viewcode-back" href="../pysic.html#pysic.is_bond_order_factor">[docs]</a><span class="k">def</span> <span class="nf">is_bond_order_factor</span><span class="p">(</span><span class="n">bond_order_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.is_valid_bond_order_factor`</span>

<span class="sd">    Parameters:</span>

<span class="sd">    bond_order_name: string</span>
<span class="sd">        the name of the bond order factor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">bond_order_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="is_valid_bond_order_factor"><a class="viewcode-back" href="../pysic.html#pysic.is_valid_bond_order_factor">[docs]</a><span class="k">def</span> <span class="nf">is_valid_bond_order_factor</span><span class="p">(</span><span class="n">bond_order_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells if the given string is the name of a bond order factor.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    bond_order_name: string</span>
<span class="sd">        the name of the bond order factor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">bond_order_name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_charge_relaxation"><a class="viewcode-back" href="../pysic.html#pysic.is_charge_relaxation">[docs]</a><span class="k">def</span> <span class="nf">is_charge_relaxation</span><span class="p">(</span><span class="n">relaxation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.is_valid_charge_relaxation`</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        relaxation_name: string</span>
<span class="sd">            the name of the relaxation mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_modes</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">relaxation_name</span> <span class="o">==</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="is_valid_charge_relaxation"><a class="viewcode-back" href="../pysic.html#pysic.is_valid_charge_relaxation">[docs]</a><span class="k">def</span> <span class="nf">is_valid_charge_relaxation</span><span class="p">(</span><span class="n">relaxation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells if the given string is the name of a charge relaxation mode.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        relaxation_name: string</span>
<span class="sd">            the name of the relaxation mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_modes</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">relaxation_name</span> <span class="o">==</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

</div>
<span class="k">def</span> <span class="nf">is_coulomb_summation</span><span class="p">(</span><span class="n">summation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as :meth:`~pysic.is_valid_coulomb_summation`</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        summation_name: string</span>
<span class="sd">            the name of the summation mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_modes</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">summation_name</span> <span class="o">==</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>



<span class="k">def</span> <span class="nf">is_valid_coulomb_summation</span><span class="p">(</span><span class="n">summation_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells if the given string is the name of a coulomb summation mode.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        summation_name: string</span>
<span class="sd">            the name of the summation mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_modes</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">summation_name</span> <span class="o">==</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
    



<div class="viewcode-block" id="number_of_targets"><a class="viewcode-back" href="../pysic.html#pysic.number_of_targets">[docs]</a><span class="k">def</span> <span class="nf">number_of_targets</span><span class="p">(</span><span class="n">potential_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells how many targets a potential or bond order factor acts on, i.e., is it pair or many-body.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential or bond order factor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_targets_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_targets_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


</div>
<div class="viewcode-block" id="number_of_parameters"><a class="viewcode-back" href="../pysic.html#pysic.number_of_parameters">[docs]</a><span class="k">def</span> <span class="nf">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span><span class="n">as_list</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells how many parameters a potential, bond order factor, charge relaxation mode or coulomb summation mode incorporates.</span>

<span class="sd">    A potential has a simple list of parameters and thus the function returns</span>
<span class="sd">    by default a single number. A bond order factor can incorporate parameters for</span>
<span class="sd">    different number of targets (some for single elements, others for pairs, etc.), and</span>
<span class="sd">    so a list of numbers is returned, representing the number of single, pair etc.</span>
<span class="sd">    parameters. If the parameter &#39;as_list&#39; is given and is True, the result is</span>
<span class="sd">    a list containing one number also for a potential.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential or bond order factor</span>
<span class="sd">    as_list: logical</span>
<span class="sd">        should the result always be a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_parameters_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n_params</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n_params</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_targets</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_targets_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span> <span class="p">]</span><span class="o">*</span><span class="n">n_targets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_targets</span><span class="p">):</span>
            <span class="n">n_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_parameters_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n_params</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">is_charge_relaxation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_parameters</span><span class="p">[</span><span class="n">potential_name</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n_params</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n_params</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">is_coulomb_summation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_parameters</span><span class="p">[</span><span class="n">potential_name</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">as_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n_params</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n_params</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="names_of_parameters"><a class="viewcode-back" href="../pysic.html#pysic.names_of_parameters">[docs]</a><span class="k">def</span> <span class="nf">names_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lists the names of the parameters of a potential, bond order factor, charge relaxation mode or coulomb summation mode.</span>

<span class="sd">    For a potential, a simple list of names is returned. For a bond order factor, the</span>
<span class="sd">    parameters are categorised according to the number of targets they apply to</span>
<span class="sd">    (single element, pair, etc.). So, for a bond order factor, a list of lists is</span>
<span class="sd">    returned, where the first list contains the single element parameters, the second</span>
<span class="sd">    list the pair parameters etc.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential or bond order factor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">param_codes</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">names_of_parameters_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">param_codes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">n_params</span><span class="p">:</span>
                <span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                
        <span class="k">return</span> <span class="n">param_names</span>

    <span class="k">elif</span><span class="p">(</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_targets</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_targets_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">param_codes</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">*</span><span class="n">n_targets</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[]</span> <span class="p">]</span><span class="o">*</span><span class="n">n_targets</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_targets</span><span class="p">):</span>
            <span class="n">param_codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">names_of_parameters_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">param_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">n_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


        <span class="n">target_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">target_codes</span> <span class="ow">in</span> <span class="n">param_codes</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">target_codes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">n_params</span><span class="p">[</span><span class="n">target_index</span><span class="p">]:</span>
                    <span class="n">param_names</span><span class="p">[</span><span class="n">target_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">param_names</span>

    <span class="k">elif</span><span class="p">(</span><span class="n">is_charge_relaxation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_parameters</span><span class="p">[</span><span class="n">potential_name</span><span class="p">]</span>

    <span class="k">elif</span><span class="p">(</span><span class="n">is_coulomb_summation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_parameters</span><span class="p">[</span><span class="n">potential_name</span><span class="p">]</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="index_of_parameter"><a class="viewcode-back" href="../pysic.html#pysic.index_of_parameter">[docs]</a><span class="k">def</span> <span class="nf">index_of_parameter</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tells the index of a parameter of a potential or bond order factor in the list of parameters the potential uses.</span>

<span class="sd">    For a potential, the index of the specified parameter is given.</span>
<span class="sd">    For a bond order factor, a list of two integers is given.</span>
<span class="sd">    These give the number of targets (single element, pair etc.) the parameter</span>
<span class="sd">    is associated with and the list index.</span>
<span class="sd">    </span>
<span class="sd">    Note especially that an index is returned, and these start counting from 0.</span>
<span class="sd">    So for a bond order factor, a parameter for pairs (2 targets) will return 1</span>
<span class="sd">    as the index for number of targets.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential or bond order factor</span>
<span class="sd">    parameter_name: string</span>
<span class="sd">        the name of the parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_charge_relaxation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">parameter_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">target_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">listed</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">listed</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">parameter_name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">target_index</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target_index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


</div>
<div class="viewcode-block" id="descriptions_of_parameters"><a class="viewcode-back" href="../pysic.html#pysic.descriptions_of_parameters">[docs]</a><span class="k">def</span> <span class="nf">descriptions_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of strings containing physical names of the parameters of a potential, bond order factor, or charge relaxation mode,</span>
<span class="sd">    e.g., &#39;spring constant&#39; or &#39;decay length&#39;.</span>
<span class="sd">    </span>
<span class="sd">    For a potential, a simple list of descriptions is returned. For a bond order factor, the</span>
<span class="sd">    parameters are categorised according to the number of targets they apply to</span>
<span class="sd">    (single element, pair, etc.). So, for a bond order factor, a list of lists is</span>
<span class="sd">    returned, where the first list contains the single element parameters, the second</span>
<span class="sd">    list the pair parameters etc.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential or bond order factor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">is_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">param_codes</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">descriptions_of_parameters_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">param_notes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">param_codes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">n_params</span><span class="p">:</span>
                <span class="n">param_notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">elif</span><span class="p">(</span><span class="n">is_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="n">n_targets</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">number_of_targets_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
        <span class="n">param_codes</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">*</span><span class="n">n_targets</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[]</span> <span class="p">]</span><span class="o">*</span><span class="n">n_targets</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_targets</span><span class="p">):</span>
            <span class="n">param_codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">descriptions_of_parameters_of_bond_order_factor</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">param_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">n_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">target_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">target_codes</span> <span class="ow">in</span> <span class="n">param_codes</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">target_codes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">n_params</span><span class="p">[</span><span class="n">target_index</span><span class="p">]:</span>
                    <span class="n">param_names</span><span class="p">[</span><span class="n">target_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">ints2str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">param_names</span>
            
    
    <span class="k">elif</span><span class="p">(</span><span class="n">is_charge_relaxation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_parameter_descriptions</span><span class="p">[</span><span class="n">potential_name</span><span class="p">]</span>
    
    <span class="k">elif</span><span class="p">(</span><span class="n">is_coulomb_summation</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_parameter_descriptions</span><span class="p">[</span><span class="n">potential_name</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">param_notes</span>

<span class="c">#</span>
<span class="c"># ToDo: implement descriptions of bond order factor and charge relaxation types</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="description_of_potential"><a class="viewcode-back" href="../pysic.html#pysic.description_of_potential">[docs]</a><span class="k">def</span> <span class="nf">description_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">,</span> <span class="n">parameter_values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                             <span class="n">elements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prints a brief description of a potential.</span>

<span class="sd">    If optional arguments are provided,</span>
<span class="sd">    they are incorporated in the description. That is, by default the method describes</span>
<span class="sd">    the general features of a potential, but it can also be used for describing a</span>
<span class="sd">    particular potential with set parameters.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    potential_name: string</span>
<span class="sd">        the name of the potential</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">param_names</span> <span class="o">=</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="n">param_notes</span> <span class="o">=</span> <span class="n">descriptions_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="n">n_targets</span> <span class="o">=</span> <span class="n">number_of_targets</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">description_of_potential</span><span class="p">(</span><span class="n">potential_name</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">potential &#39;{pot}&#39;</span>
<span class="s">    </span>
<span class="s">{n_targ}-body interaction</span>

<span class="s">{descr}</span>
<span class="s">parameters ({n_par}):</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="n">potential_name</span><span class="p">,</span><span class="n">n_targ</span><span class="o">=</span><span class="n">n_targets</span><span class="p">,</span><span class="n">descr</span><span class="o">=</span><span class="n">description</span><span class="p">,</span><span class="n">n_par</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">n_params</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">parameter_values</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">para</span><span class="p">,</span> <span class="n">note</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_names</span><span class="p">,</span> <span class="n">param_notes</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;{pa} : {no}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pa</span><span class="o">=</span><span class="n">para</span><span class="p">,</span><span class="n">no</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">para</span><span class="p">,</span> <span class="n">note</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_names</span><span class="p">,</span> <span class="n">param_notes</span><span class="p">,</span> <span class="n">parameter_values</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;{pa} : {no} = {va}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pa</span><span class="o">=</span><span class="n">para</span><span class="p">,</span><span class="n">no</span><span class="o">=</span><span class="n">note</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cutoff</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">cutoff = {cut}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cut</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cutoff</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">elements</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">targeted symbols:&quot;</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>            
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot; {0} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ele</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="k">if</span> <span class="n">tags</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">targeted tags:&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot; {0} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="k">if</span> <span class="n">indices</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">targeted indices:&quot;</span>
        <span class="k">for</span> <span class="n">indy</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot; {0} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indy</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            
    <span class="k">print</span> <span class="n">message</span>



</div>
<div class="viewcode-block" id="CoulombSummation"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation">[docs]</a><span class="k">class</span> <span class="nc">CoulombSummation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for representing a collection of parameters for evaluating Coulomb potentials.</span>

<span class="sd">    Summing :math:`1/r` potentials in periodic systems requires more </span>
<span class="sd">    advanced techniques than just direct summation of pair interactions.</span>
<span class="sd">    The starndard method for evaluating these kinds of potentials is through</span>
<span class="sd">    Ewald summation, where the long range part of the potential is evaluated</span>
<span class="sd">    in reciprocal space.</span>
<span class="sd">    </span>
<span class="sd">    Instances of this class are used for wrapping the parameters controlling</span>
<span class="sd">    the summations. Passing such an instance to the :class:`~pysic.Pysic`</span>
<span class="sd">    calculator activates the evaluation of Coulomb interactions.</span>
<span class="sd">    </span>
<span class="sd">    Currently, only Ewald summation is available as a calculation method.</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">    method: string</span>
<span class="sd">        keyword specifying the method of summation</span>
<span class="sd">    parameters: list of doubles</span>
<span class="sd">        numeric values of summation parameters</span>
<span class="sd">    scaler: list of doubles</span>
<span class="sd">        numeric values for scaling the atomic charges in summation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">summation_modes</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;ewald&#39;</span> <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;Names of the summation methods. These are keywords used for setting up the summation algorithms.&quot;&quot;&quot;</span>
    <span class="n">summation_parameters</span> <span class="o">=</span> <span class="p">{</span> <span class="n">summation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;real_cutoff&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;k_cutoff&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;sigma&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;epsilon&#39;</span><span class="p">]</span> <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Names of the parameters of the summation algorithm.&quot;&quot;&quot;</span>
    <span class="n">summation_parameter_descriptions</span> <span class="o">=</span> <span class="p">{</span> <span class="n">summation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;real space cutoff radius&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;reciprocal space cutoff radius&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;ewald summation split parameter&#39;</span><span class="p">,</span>
                                                   <span class="s">&#39;vacuum permittivity&#39;</span><span class="p">]</span> <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Short descriptions of the parameters of the summation algorithm.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;ewald&#39;</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">scaler</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_summation</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scaling_factors</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">scaler</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
                    
        <span class="k">return</span> <span class="bp">True</span>
    
    
    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;CoulombSummation(method=&#39;{m}&#39;,parameters={p},scaler={s})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                                                                                 <span class="n">p</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
                                                                                 <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">))</span>


<span class="c"># ToDo: make an InvalidSummationError</span>
<div class="viewcode-block" id="CoulombSummation.set_summation"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.set_summation">[docs]</a>    <span class="k">def</span> <span class="nf">set_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the summation method.</span>
<span class="sd">            </span>
<span class="sd">            The method also creates a dictionary of parameters initialized to 0.0</span>
<span class="sd">            by invoking :meth:`~pysic.CoulombSummation.initialize_parameters`.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            method: string</span>
<span class="sd">                a keyword specifying the mode of summation</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_modes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_parameters</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;no such summation mode &quot;</span><span class="o">+</span><span class="n">method</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="CoulombSummation.initialize_parameters"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.initialize_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dictionary of parameters and initializes all values to 0.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

                
</div>
<div class="viewcode-block" id="CoulombSummation.set_parameters"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.set_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values for all parameters.</span>
<span class="sd">        </span>
<span class="sd">        Equivalent to :meth:`~pysic.CoulombSummation.set_parameter_values`</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        parameters: list of doubles</span>
<span class="sd">            list of values to be assigned to parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_values</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    
    </div>
<div class="viewcode-block" id="CoulombSummation.set_parameter_values"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.set_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values for all parameters.                    </span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            parameters: list of doubles</span>
<span class="sd">                list of values to be assigned to parameters</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;The summation mode &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">+</span><span class="s">&quot; requires &quot;</span><span class="o">+</span>
                                         <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; parameters.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
    
</div>
<div class="viewcode-block" id="CoulombSummation.set_parameter_value"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.set_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a given parameter to the desired value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        parameter_name: string</span>
<span class="sd">            name of the parameter</span>
<span class="sd">        value: double</span>
<span class="sd">            the new value of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

</div>
<div class="viewcode-block" id="CoulombSummation.set_scaling_factors"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.set_scaling_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the list of scaling parameters for atomic charges.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            scaler: list of doubles</span>
<span class="sd">                the list of scaling factors</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">scaler</span>
                
</div>
<div class="viewcode-block" id="CoulombSummation.get_scaling_factors"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.get_scaling_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of scaling parameters for atomic charges.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span>
                
                </div>
<div class="viewcode-block" id="CoulombSummation.get_summation"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.get_summation">[docs]</a>    <span class="k">def</span> <span class="nf">get_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the mode of summation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
</div>
<div class="viewcode-block" id="CoulombSummation.get_parameters"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.get_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing the numeric values of the parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
</div>
<div class="viewcode-block" id="CoulombSummation.get_realspace_cutoff"><a class="viewcode-back" href="../coulombsummation class.html#pysic.CoulombSummation.get_realspace_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">get_realspace_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the real space cutoff.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c">#ewald</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;real_cutoff&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="mf">0.0</span>

</div></div>
<div class="viewcode-block" id="BondOrderParameters"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters">[docs]</a><span class="k">class</span> <span class="nc">BondOrderParameters</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for representing a collection of parameters for bond order calculations.</span>

<span class="sd">    Calculating bond order factors using Tersoff-like methods defined in</span>
<span class="sd">    :class:`~pysic.Coordinator` requires several parameters per element and</span>
<span class="sd">    element pair. To facilitate the handling of all these parameters, they are</span>
<span class="sd">    wrapped in a BondOrderParameters object.</span>

<span class="sd">    The object can be created empty and filled later with the parameters. Alternatively,</span>
<span class="sd">    a list of parameters can be given upon initialization in which case it is passed</span>
<span class="sd">    to the :meth:`~pysic.BondOrderParameter.set_parameters` method.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    bond_order_type: string</span>
<span class="sd">        a keyword specifying the type of the bond order factor</span>
<span class="sd">    soft_cut: double</span>
<span class="sd">        The soft cutoff for calculating partial coordination.</span>
<span class="sd">        Any atom closer than this is considered a full neighbor.</span>
<span class="sd">    hard_cut: double</span>
<span class="sd">        The hard cutoff for calculating partial coordination.</span>
<span class="sd">        Any atom closer than this is considered (at least) a partial neighbor</span>
<span class="sd">        and will give a fractional contribution to the total coordination.</span>
<span class="sd">        Any atom farther than this will not contribute to the neighbor count.</span>
<span class="sd">    parameters: list of doubles</span>
<span class="sd">        a list of parameters to be contained in the parameter object</span>
<span class="sd">    symbols: list of strings</span>
<span class="sd">        a list of elements on which the factor is applied</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bond_order_type</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">cutoff_margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">symbols</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_valid_bond_order_factor</span><span class="p">(</span><span class="n">bond_order_type</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&#39;There is no bond order factor called &quot;{bof}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bof</span><span class="o">=</span><span class="n">bond_order_type</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span> <span class="o">=</span> <span class="n">bond_order_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoff_margin</span><span class="p">(</span><span class="n">cutoff_margin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span> <span class="o">=</span> <span class="n">number_of_targets</span><span class="p">(</span><span class="n">bond_order_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span> <span class="o">=</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="n">bond_order_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_params</span> <span class="o">=</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="n">bond_order_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="o">*</span><span class="p">[[]]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;BondOrderParameters( bond_order_type=&#39;&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span><span class="o">+</span>\
               <span class="s">&quot;&#39;,cutoff=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;,cutoff_margin=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span><span class="p">)</span><span class="o">+</span>\
               <span class="s">&quot;,parameters=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;,symbols=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; )&quot;</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">bond_order_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff_margin</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        

            
<div class="viewcode-block" id="BondOrderParameters.accepts_parameters"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.accepts_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">accepts_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the given parameters array has the correct dimensions.</span>

<span class="sd">        A bond order parameter can contain separate parameters for single,</span>
<span class="sd">        pair etc. elements and each class can have a different number of</span>
<span class="sd">        parameters. This method checks if the given list has the correct</span>
<span class="sd">        dimensions.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        params: list of doubles</span>
<span class="sd">            list of parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.get_number_of_parameters"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_number_of_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of parameters the bond order parameter object contains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_params</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.get_number_of_targets"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_number_of_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the (maximum) number of targets the bond order factor affects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_parameters_as_list"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_parameters_as_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameters_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the parameters of the bond order factor as a single list.</span>

<span class="sd">        The generated list first contains the single element parameters, then</span>
<span class="sd">        pair parameters, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allparams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">target_params</span><span class="p">:</span>
                <span class="n">allparams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">allparams</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.set_symbols"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">set_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the list of symbols to equal the given list.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        symbols: list of strings</span>
<span class="sd">            list of element symbols on which the bond order factor acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">symbols</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>

        </div>
<div class="viewcode-block" id="BondOrderParameters.add_symbols"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.add_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">add_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the given symbols to the list of symbols.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        symbols: list of strings</span>
<span class="sd">            list of additional symbols on which the bond order factor acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">symbols</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.get_symbols"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">get_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the symbols the bond parameters affect.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_different_symbols"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_different_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">get_different_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing each symbol the potential affects once.&quot;&quot;&quot;</span>
        <span class="n">all_symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_symbols</span>

        <span class="k">for</span> <span class="n">symblist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">symblist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">all_symbols</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_symbols</span>


</div>
<div class="viewcode-block" id="BondOrderParameters.get_parameter_values"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing the current parameter values of the potential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_parameter_names"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_parameter_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the names of the parameters of the potential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.get_parameter_value"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">param_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of the given parameter.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        param_name: string</span>
<span class="sd">            name of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">index_of_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span><span class="p">,</span><span class="n">param_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.get_bond_order_type"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_bond_order_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_bond_order_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the keyword specifying the type of the bond order factor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_cutoff"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">get_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_cutoff_margin"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_cutoff_margin">[docs]</a>    <span class="k">def</span> <span class="nf">get_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the margin for a smooth cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.get_soft_cutoff"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.get_soft_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">get_soft_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the lower limit for a smooth cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.set_parameter_values"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values of all parameters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        params: list of doubles</span>
<span class="sd">            list of values to be assigned to parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.set_parameter_value"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameter_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a given parameter to the desired value.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        parameter_name: string</span>
<span class="sd">            name of the parameter</span>
<span class="sd">        value: double</span>
<span class="sd">            the new value of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">index_of_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span><span class="p">,</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;The bond order factor &#39;{pot}&#39; does not have a parameter &#39;{para}&#39;&quot;</span><span class="o">.</span>
                                        <span class="n">format</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_order_type</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="BondOrderParameters.set_cutoff"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">set_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cutoff to a given value.</span>

<span class="sd">        This method affects the hard cutoff.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>

<span class="sd">        cutoff: double</span>
<span class="sd">            new cutoff for the bond order factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.set_cutoff_margin"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_cutoff_margin">[docs]</a>    <span class="k">def</span> <span class="nf">set_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">margin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the margin for smooth cutoff to a given value.</span>

<span class="sd">        This method defines the decay interval :math:`r_\mathrm{hard}-r_\mathrm{soft}`.</span>
<span class="sd">        Note that if the soft cutoff value is made smaller than 0 or larger than the</span>
<span class="sd">        hard cutoff value an :class:`~pysic.InvalidParametersError` is raised.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        margin: double</span>
<span class="sd">            The new cutoff margin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;A negative cutoff margin of {marg} was given.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">marg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">margin</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;A cutoff margin ({marg}) longer than the hard cutoff ({hard}) was given.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">marg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">margin</span><span class="p">),</span> <span class="n">hard</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span> <span class="o">=</span> <span class="n">margin</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.set_soft_cutoff"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_soft_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">set_soft_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the soft cutoff to a given value.</span>

<span class="sd">        Note that actually the cutoff margin is recorded, so changing the</span>
<span class="sd">        hard cutoff (see :meth:`~pysic.BondOrderParameters.set_cutoff`) will also affect the</span>
<span class="sd">        soft cutoff.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        cutoff: double</span>
<span class="sd">            The new soft cutoff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="o">-</span><span class="n">cutoff</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="BondOrderParameters.accepts_target_list"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.accepts_target_list">[docs]</a>    <span class="k">def</span> <span class="nf">accepts_target_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests whether a list is suitable as a list of targets, i.e., element symbols</span>
<span class="sd">        and returns True or False accordingly.</span>

<span class="sd">        A list of targets should be of the format::</span>

<span class="sd">            targets = [[a, b], [c, d]]</span>

<span class="sd">        where the length of the sublists must equal the number of targets.</span>

<span class="sd">        It is not tested that the values contained in the list are valid.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        targets: list of strings or integers</span>
<span class="sd">            a list whose format is checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_targets</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a_set</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a_set</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_set</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_targets</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="BondOrderParameters.set_parameters"><a class="viewcode-back" href="../bondorderparameters class.html#pysic.BondOrderParameters.set_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values of all parameters.</span>

<span class="sd">        Equivalent to :meth:`~pysic.BondOrderParameters.set_parameter_values`.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        params: list of doubles</span>
<span class="sd">            list of values to be assigned to parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepts_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&#39;The bond order factor &quot;{bof}&quot; requires {num} parameters.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bof</span><span class="o">=</span><span class="n">bond_order_type</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_params</span><span class="p">)))</span>


        
        </div></div>
<div class="viewcode-block" id="Coordinator"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator">[docs]</a><span class="k">class</span> <span class="nc">Coordinator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for representing a calculator for atomic coordination numbers and bond order factors.</span>

<span class="sd">    Pysic can utilise &#39;Tersoff-like&#39; potentials which are locally scaled according to</span>
<span class="sd">    bond order factors, related to the number of neighbors of each atom.</span>
<span class="sd">    The coordination calculator keeps track of updating</span>
<span class="sd">    the bond order factors and holds the parameters for calculating the values.</span>

<span class="sd">    When calculating forces also the derivatives of the coordination numbers are needed.</span>
<span class="sd">    Coordination numbers may be used repeatedly when calculating energies and forces even within</span>
<span class="sd">    one evaluation of the forces and therefore they are stored by the calculator. Derivatives</span>
<span class="sd">    are not stored since storing them could</span>
<span class="sd">    potentially require an N x N matrix, where N is the number of particles.</span>

<span class="sd">    The calculation of coordination is an operation on the geometry, not the complete physical</span>
<span class="sd">    system including the interactions, and so one can define coordination calculators as</span>
<span class="sd">    standalone objects as well. They always operate on the geometry currently allocated in the core.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    bond_order_parameters: list of :class:`~pysic.BondOrderParameters` objects</span>
<span class="sd">        Parameters for calculating bond order factors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bond_order_parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_factors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span><span class="p">(</span><span class="n">bond_order_parameters</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_bond_order_parameters</span><span class="p">(</span><span class="n">bond_order_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_index</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">group_index</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">bond_order_params</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Coordinator(bond_order_parameters={bonds})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bonds</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span><span class="p">))</span>



<div class="viewcode-block" id="Coordinator.get_bond_order_parameters"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.get_bond_order_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_bond_order_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the bond order parameters of this Coordinator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span>

</div>
<div class="viewcode-block" id="Coordinator.set_bond_order_parameters"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.set_bond_order_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_bond_order_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns new bond order parameters to this Coordinator.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        params: :class:`~pysic.BondOrderCoordinator`</span>
<span class="sd">            new bond order parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Coordinator.add_bond_order_parameters"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.add_bond_order_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">add_bond_order_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the given parameters to this Coordinator.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        params: :class:`~pysic.BondOrderCoordinator`</span>
<span class="sd">            new bond order parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_params</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">params</span><span class="p">])</span>
        
</div>
<div class="viewcode-block" id="Coordinator.set_group_index"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.set_group_index">[docs]</a>    <span class="k">def</span> <span class="nf">set_group_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets an index for the coordinator object.</span>

<span class="sd">        In the fortran core, bond order parameters are calculated by</span>
<span class="sd">        bond order parameters. Since a coordinator contains many, they are grouped</span>
<span class="sd">        to a coordinator via a grouping index when the core is initialized.</span>
<span class="sd">        This method is meant to be used for telling the Coordinator of this</span>
<span class="sd">        index. That allows the bond orders can be calculated by calling the</span>
<span class="sd">        Coordinator itself, since the index tells which bond parameters in the</span>
<span class="sd">        core are needed.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        index: integer</span>
<span class="sd">            an index for grouping bond order parameters in the core</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_index</span> <span class="o">=</span> <span class="n">index</span>
</div>
<div class="viewcode-block" id="Coordinator.get_group_index"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.get_group_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_group_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the group index of the Coordinator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_index</span>
</div>
<div class="viewcode-block" id="Coordinator.calculate_bond_order_factors"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.calculate_bond_order_factors">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_bond_order_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recalculates the bond order factors for all atoms and stores them.</span>

<span class="sd">        Similarly to coordination numbers (:meth:`~pysic.Coordinator.calculate_coordination`),</span>
<span class="sd">        this method only calculates the factors and stores them but does not return them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_factors</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_index</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Coordinator.get_bond_order_factors"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.get_bond_order_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_bond_order_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an array containing the bond order factors of all atoms.</span>

<span class="sd">        This method does not calculate the bond order factors but returns the</span>
<span class="sd">        precalculated array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_factors</span>


    </div>
<div class="viewcode-block" id="Coordinator.get_bond_order_gradients"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.get_bond_order_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">get_bond_order_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atom_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an array containing the gradients of bond order factors of all atoms with respect to moving one atom.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atom_index: integer</span>
<span class="sd">            the index of the atom the position of which is being differentiated with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="c"># add 1 to atom index because fortran indexing starts from 1, not 0</span>
        <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_bond_order_gradients</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_index</span><span class="p">,</span><span class="n">atom_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="Coordinator.get_bond_order_gradients_of_factor"><a class="viewcode-back" href="../coordinator class.html#pysic.Coordinator.get_bond_order_gradients_of_factor">[docs]</a>    <span class="k">def</span> <span class="nf">get_bond_order_gradients_of_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atom_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an array containing the gradients of the bond order factor of one atom with respect to moving any atom.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atom_index: integer</span>
<span class="sd">            the index of the atom the position of which is being differentiated with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="c"># add 1 to atom index because fortran indexing starts from 1, not 0</span>
        <span class="k">return</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_bond_order_gradients_of_factor</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_index</span><span class="p">,</span><span class="n">atom_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>


</div></div>
<div class="viewcode-block" id="Potential"><a class="viewcode-back" href="../potential class.html#pysic.Potential">[docs]</a><span class="k">class</span> <span class="nc">Potential</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for representing a potential.</span>

<span class="sd">    Several types of potentials can be defined by specifying the type of the potential</span>
<span class="sd">    as a keyword. The potentials contain a host of parameters and information on</span>
<span class="sd">    what types of particles they act on. To view a list of available potentials, use the method</span>
<span class="sd">    :meth:`~pysic.list_valid_potentials`.</span>

<span class="sd">    A potential may be a pair or many-body potential: here, the bodies a potential</span>
<span class="sd">    acts on are called targets. Thus specifying the number of targets of a potential also</span>
<span class="sd">    determines if the potential is a many-body potential.</span>
<span class="sd">    </span>
<span class="sd">    A potential may be defined for atom types or specifically for certain atoms. These are</span>
<span class="sd">    specified by the symbols, tags, and indices. Each of these should be either &#39;None&#39; or</span>
<span class="sd">    a list of lists of n values where n is the number of targets. For example, if::</span>

<span class="sd">        indices = [[0, 1], [1, 2], [2, 3]]</span>

<span class="sd">    the potential will be applied between atoms 0 and 1, 1 and 2, and 2 and 3.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    symbols: list of string</span>
<span class="sd">        the chemical symbols (elements) on which the potential acts</span>
<span class="sd">    tags: integer</span>
<span class="sd">        atoms with specific tags on which the potential acts</span>
<span class="sd">    indices: list of integers</span>
<span class="sd">        atoms with specific indices on which the potential acts</span>
<span class="sd">    potential_type: string</span>
<span class="sd">        a keyword specifying the type of the potential</span>
<span class="sd">    parameters: list of doubles</span>
<span class="sd">        a list of parameters for characterizing the potential; their meaning depends on the type of potential</span>
<span class="sd">    cutoff: double</span>
<span class="sd">        the maximum atomic separation at which the potential is applied</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">potential_type</span><span class="p">,</span><span class="n">symbols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">tags</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">indices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">cutoff_margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">coordinator</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">is_valid_potential</span><span class="p">(</span><span class="n">potential_type</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span> <span class="o">=</span> <span class="n">potential_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoff_margin</span><span class="p">(</span><span class="n">cutoff_margin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span> <span class="o">=</span> <span class="n">number_of_targets</span><span class="p">(</span><span class="n">potential_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span> <span class="o">=</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="n">potential_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
                
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span>
                    <span class="s">&#39;The potential &quot;{pot}&quot; requires {num} parameters: {par}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">pot</span><span class="o">=</span><span class="n">potential_type</span><span class="p">,</span>
                    <span class="n">num</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">number_of_parameters</span><span class="p">(</span><span class="n">potential_type</span><span class="p">)),</span>
                    <span class="n">par</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">names_of_parameters</span><span class="p">(</span><span class="n">potential_type</span><span class="p">))</span>
                    <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_coordinator</span><span class="p">(</span><span class="n">coordinator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&#39;There is no potential called &quot;{pot}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="n">potential_type</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">potential_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>         
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">coordinator</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>               
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;Potential({name},symbols={symbs},&quot;</span><span class="o">+</span> \
                <span class="s">&quot;tags={tags},indices={inds},parameters={params}&quot;</span><span class="o">+</span> \
                <span class="s">&quot;,cutoff={cut},cutoff_margin={marg},&quot;</span><span class="o">+</span> \
                <span class="s">&quot;coordinator={coord})&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span>
                                               <span class="n">symbs</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">),</span>
                                               <span class="n">tags</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">),</span>
                                               <span class="n">inds</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                                               <span class="n">params</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
                                               <span class="n">cut</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">),</span>
                                               <span class="n">marg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span><span class="p">),</span>
                                               <span class="n">coord</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span><span class="p">))</span>
    
                                          
<div class="viewcode-block" id="Potential.get_symbols"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">get_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the chemical symbols (elements) on which the potential</span>
<span class="sd">        acts on.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
</div>
<div class="viewcode-block" id="Potential.get_tags"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the tags on which the potential acts on.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>
</div>
<div class="viewcode-block" id="Potential.get_indices"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_indices">[docs]</a>    <span class="k">def</span> <span class="nf">get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of indices on which the potential acts on. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span>
</div>
<div class="viewcode-block" id="Potential.get_different_symbols"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_different_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">get_different_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing each symbol the potential affects once.&quot;&quot;&quot;</span>
        <span class="n">all_symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_symbols</span>

        <span class="k">for</span> <span class="n">symblist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">symblist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">all_symbols</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_symbols</span>
</div>
<div class="viewcode-block" id="Potential.get_different_tags"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_different_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_different_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing each tag the potential affects once.&quot;&quot;&quot;</span>
        <span class="n">all_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_tags</span>
            
        <span class="k">for</span> <span class="n">taglist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">taglist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">all_tags</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_tags</span>
</div>
<div class="viewcode-block" id="Potential.get_different_indices"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_different_indices">[docs]</a>    <span class="k">def</span> <span class="nf">get_different_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing each index the potential affects once.&quot;&quot;&quot;</span>
        <span class="n">all_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_indices</span>

        <span class="k">for</span> <span class="n">indicelist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indicelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">all_indices</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_indices</span>
    </div>
<div class="viewcode-block" id="Potential.get_parameter_values"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing the current parameter values of the potential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
</div>
<div class="viewcode-block" id="Potential.get_parameter_names"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_parameter_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the names of the parameters of the potential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_of_params</span>
</div>
<div class="viewcode-block" id="Potential.get_parameter_value"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">param_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of the given parameter.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        param_name: string</span>
<span class="sd">            name of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index_of_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span><span class="n">param_name</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Potential.get_potential_type"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_potential_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_potential_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the keyword specifying the type of the potential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span>
</div>
<div class="viewcode-block" id="Potential.get_cutoff"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">get_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
</div>
<div class="viewcode-block" id="Potential.get_cutoff_margin"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_cutoff_margin">[docs]</a>    <span class="k">def</span> <span class="nf">get_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the margin for a smooth cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span>
</div>
<div class="viewcode-block" id="Potential.get_soft_cutoff"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_soft_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">get_soft_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the lower limit for a smooth cutoff.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span>
</div>
<div class="viewcode-block" id="Potential.get_number_of_targets"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_number_of_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of targets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span>
</div>
<div class="viewcode-block" id="Potential.accepts_target_list"><a class="viewcode-back" href="../potential class.html#pysic.Potential.accepts_target_list">[docs]</a>    <span class="k">def</span> <span class="nf">accepts_target_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests whether a list is suitable as a list of targets, i.e., symbols, tags, or indices</span>
<span class="sd">        and returns True or False accordingly.</span>

<span class="sd">        A list of targets should be of the format::</span>

<span class="sd">            targets = [[a, b], [c, d]]</span>

<span class="sd">        where the length of the sublists must equal the number of targets.</span>

<span class="sd">        It is not tested that the values contained in the list are valid.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        targets: list of strings or integers</span>
<span class="sd">            a list whose format is checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_targets</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a_set</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a_set</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_set</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_targets</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Potential.get_coordinator"><a class="viewcode-back" href="../potential class.html#pysic.Potential.get_coordinator">[docs]</a>    <span class="k">def</span> <span class="nf">get_coordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the Coordinator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span>
</div>
<div class="viewcode-block" id="Potential.set_coordinator"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_coordinator">[docs]</a>    <span class="k">def</span> <span class="nf">set_coordinator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coordinator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a new Coordinator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">=</span> <span class="n">coordinator</span>
        
</div>
<div class="viewcode-block" id="Potential.set_symbols"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">set_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the list of symbols to equal the given list.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        symbols: list of strings</span>
<span class="sd">            list of element symbols on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">symbols</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Potential.set_tags"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the list of tags to equal the given list.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        tags: list of integers</span>
<span class="sd">            list of tags on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tags</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">tags</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">tags</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Potential.set_indices"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_indices">[docs]</a>    <span class="k">def</span> <span class="nf">set_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the list of indices to equal the given list.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        indices: list of integers</span>
<span class="sd">            list of integers on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">indices</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Potential.add_symbols"><a class="viewcode-back" href="../potential class.html#pysic.Potential.add_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">add_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the given symbols to the list of symbols.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        symbols: list of strings</span>
<span class="sd">            list of additional symbols on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">symbols</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
            
</div>
<div class="viewcode-block" id="Potential.add_tags"><a class="viewcode-back" href="../potential class.html#pysic.Potential.add_tags">[docs]</a>    <span class="k">def</span> <span class="nf">add_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the given tags to the list of tags.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        tags: list of integers</span>
<span class="sd">            list of additional tags on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">tags</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">tags</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="Potential.add_indices"><a class="viewcode-back" href="../potential class.html#pysic.Potential.add_indices">[docs]</a>    <span class="k">def</span> <span class="nf">add_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds the given indices to the list of indices.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        indices: list of integers</span>
<span class="sd">            list of additional indices on which the potential acts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepts_target_list</span><span class="p">([</span><span class="n">indices</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;Invalid number of targets.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Potential.set_parameters"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values of all parameters.</span>

<span class="sd">        Equivalent to :meth:`~pysic.Potential.set_parameter_values`.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        values: list of doubles</span>
<span class="sd">            list of values to be assigned to parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_values</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    </div>
<div class="viewcode-block" id="Potential.set_parameter_values"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values of all parameters.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        values: list of doubles</span>
<span class="sd">            list of values to be assigned to parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;The potential &#39;{pot}&#39; takes {n_par} parameters, not {n_in}.&quot;</span><span class="o">.</span>
                                        <span class="n">format</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span>
                                               <span class="n">n_par</span><span class="o">=</span><span class="n">number_of_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">),</span>
                                               <span class="n">n_in</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="Potential.set_parameter_value"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameter_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a given parameter to the desired value.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        parameter_name: string</span>
<span class="sd">            name of the parameter</span>
<span class="sd">        value: double</span>
<span class="sd">            the new value of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index_of_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;The potential &#39;{pot}&#39; does not have a parameter &#39;{para}&#39;&quot;</span><span class="o">.</span>
                                        <span class="n">format</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Potential.set_cutoff"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">set_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cutoff to a given value.</span>

<span class="sd">        This method affects the hard cutoff.</span>
<span class="sd">        For a detailed explanation on how to define a soft cutoff, see :meth:`~pysic.Potential.set_cutoff_margin`.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>

<span class="sd">        cutoff: double</span>
<span class="sd">            new cutoff for the potential</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>

</div>
<div class="viewcode-block" id="Potential.set_cutoff_margin"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_cutoff_margin">[docs]</a>    <span class="k">def</span> <span class="nf">set_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">margin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the margin for smooth cutoff to a given value.</span>

<span class="sd">        Many potentials decay towards zero in infinity, but in a numeric simulation</span>
<span class="sd">        they are cut at a finite range as specified by the cutoff radius. If the potential</span>
<span class="sd">        is not exactly zero at this range, a discontinuity will be introduced.</span>
<span class="sd">        It is possible to avoid this by including a smoothening factor in the potential</span>
<span class="sd">        to force a decay to zero in a finite interval.</span>

<span class="sd">        This method defines the decay interval :math:`r_\mathrm{hard}-r_\mathrm{soft}`.</span>
<span class="sd">        Note that if the soft cutoff value is made smaller than 0 or larger than the</span>
<span class="sd">        hard cutoff value an :class:`~pysic.InvalidPotentialError` is raised.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        margin: double</span>
<span class="sd">            The new cutoff margin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;A negative cutoff margin of {marg} was given.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">marg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">margin</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidPotentialError</span><span class="p">(</span><span class="s">&quot;A cutoff margin ({marg}) longer than the hard cutoff ({hard}) was given.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">marg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">margin</span><span class="p">),</span> <span class="n">hard</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_margin</span> <span class="o">=</span> <span class="n">margin</span>

</div>
<div class="viewcode-block" id="Potential.set_soft_cutoff"><a class="viewcode-back" href="../potential class.html#pysic.Potential.set_soft_cutoff">[docs]</a>    <span class="k">def</span> <span class="nf">set_soft_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the soft cutoff to a given value.</span>

<span class="sd">        For a detailed explanation on the meaning of a soft cutoff, see</span>
<span class="sd">        :meth:`~pysic.Potential.set_cutoff_margin`.</span>
<span class="sd">        Note that actually the cutoff margin is recorded, so changing the</span>
<span class="sd">        hard cutoff (see :meth:`~pysic.Potential.set_cutoff`) will also affect the</span>
<span class="sd">        soft cutoff.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        cutoff: double</span>
<span class="sd">            The new soft cutoff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoff_margin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="o">-</span><span class="n">cutoff</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Potential.describe"><a class="viewcode-back" href="../potential class.html#pysic.Potential.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a short description of the potential using the method :meth:`~pysic.describe_potential`.&quot;&quot;&quot;</span>
        <span class="n">description_of_potential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_type</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="ChargeRelaxation"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation">[docs]</a><span class="k">class</span> <span class="nc">ChargeRelaxation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class for handling charge dynamics and relaxation.</span>
<span class="sd">        </span>
<span class="sd">        Pysic does not implement molecular dynamics or geometric</span>
<span class="sd">        optimization since they are handled by ASE.</span>
<span class="sd">        Conceptually, the structural dynamics of the system are</span>
<span class="sd">        properties of the atomic geometry and so it makes sense that</span>
<span class="sd">        they are handled by ASE, which defines the atomic structure</span>
<span class="sd">        in the first place, in the `ASE Atoms`_ class.</span>
<span class="sd">        </span>
<span class="sd">        On the other hand, charge dynamics are related to the electronic</span>
<span class="sd">        structure of the system. Since ASE is meant to use methods such as </span>
<span class="sd">        density functional theory (DFT) in the calculators is employs, all</span>
<span class="sd">        electronic properties are left at the responsibilty of the</span>
<span class="sd">        calculator. This makes sense since in DFT the electron density is </span>
<span class="sd">        needed for calculations of forces and energies.</span>
<span class="sd">        </span>
<span class="sd">        Pysic is not a DFT calculator and there is no electron density</span>
<span class="sd">        but the atomic charges can be made to develop dynamically. The</span>
<span class="sd">        ChargeRelaxation class handles these dynamics.</span>
<span class="sd">        </span>
<span class="sd">        .. _ASE Atoms: https://wiki.fysik.dtu.dk/ase/ase/atoms.html</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        relaxation: string</span>
<span class="sd">            a keyword specifying the mode of charge relaxation</span>
<span class="sd">        calculator: :class:`~pysic.Pysic` object</span>
<span class="sd">            a Pysic calculator </span>
<span class="sd">        parameters: list of doubles</span>
<span class="sd">            numeric values for parameters        </span>
<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            The system whose charges are to be relaxed. </span>
<span class="sd">            Note! The relaxation is always done using the atoms copy in </span>
<span class="sd">            :class:`~pysic.Pysic`, but if the original structure needs to be</span>
<span class="sd">            updated as well, the relaxation algorithm must have access to it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">relaxation_modes</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;dynamic&#39;</span> <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;Names of the charge relaxation algorithms available. </span>
<span class="sd">        </span>
<span class="sd">        These are keywords needed when creating the </span>
<span class="sd">        :class:`~pysic.ChargeRelaxation` objects as type specifiers.&quot;&quot;&quot;</span>
    
    <span class="n">relaxation_parameters</span> <span class="o">=</span> <span class="p">{</span> <span class="n">relaxation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;n_steps&#39;</span><span class="p">,</span> <span class="s">&#39;timestep&#39;</span><span class="p">,</span> <span class="s">&#39;inertia&#39;</span><span class="p">,</span> <span class="s">&#39;friction&#39;</span><span class="p">,</span> <span class="s">&#39;tolerance&#39;</span><span class="p">]</span> <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Names of the parameters of the charge relaxation algorithms.&quot;&quot;&quot;</span>
    
    <span class="n">relaxation_parameter_descriptions</span> <span class="o">=</span> <span class="p">{</span> <span class="n">relaxation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;time steps of charge dynamics between molecular dynamics&#39;</span><span class="p">,</span> 
                                                                 <span class="s">&#39;time step of charge dynamics&#39;</span><span class="p">,</span> 
                                                                 <span class="s">&#39;fictional charge mass&#39;</span><span class="p">,</span> 
                                                                 <span class="s">&#39;friction coefficient for damped charge dynamics&#39;</span><span class="p">,</span>
                                                                 <span class="s">&#39;convergence tolerance&#39;</span><span class="p">]</span> <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Short descriptions of the relaxation parameters.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relaxation</span><span class="o">=</span><span class="s">&#39;dynamic&#39;</span><span class="p">,</span> <span class="n">calculator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_relaxation</span><span class="p">(</span><span class="n">relaxation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_calculator</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">relaxation</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">calculator</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

            
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;ChargeRelaxation(&#39;{m}&#39;,calculator={c},parameters={p},atoms={a})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span><span class="p">,</span> 
            <span class="n">c</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="p">),</span> 
            <span class="n">p</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
            <span class="n">a</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="p">)</span>
            
            
<div class="viewcode-block" id="ChargeRelaxation.set_calculator"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_calculator">[docs]</a>    <span class="k">def</span> <span class="nf">set_calculator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calculator</span><span class="p">,</span> <span class="n">reciprocal</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns a :class:`~pysic.Pysic` calculator.</span>
<span class="sd">            </span>
<span class="sd">            The calculator is necessary for calculation of electronegativities.</span>
<span class="sd">            It is also possible to automatically assign the charge relaxation</span>
<span class="sd">            method to the calculator by setting ``reciprocal = True``. </span>
<span class="sd">            </span>
<span class="sd">            Note though</span>
<span class="sd">            that it does make a difference whether the calculator knows the</span>
<span class="sd">            charge relaxation or not: If the :class:`~pysic.Pysic` has a connection</span>
<span class="sd">            to the :class:`~pysic.ChargeRelaxation`, every time force or energy calculations</span>
<span class="sd">            are requested the charges are first relaxed by automatically invoking</span>
<span class="sd">            :meth:`~pysic.ChargeRelaxation.charge_relaxation`. If there is no link,</span>
<span class="sd">            it is up to the user to start the relaxation.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            calculator: :class:`~pysic.Pysic` object</span>
<span class="sd">                a Pysic calculator</span>
<span class="sd">            reciprocal: logical</span>
<span class="sd">                if True, also the :class:`~pysic.ChargeRelaxation` is passed to the</span>
<span class="sd">                :class:`~pysic.Pysic` through :meth:`~pysic.Pysic.set_charge_relaxation`.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="c"># remove possible return link from the calculator</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span> <span class="o">!=</span> <span class="n">calculator</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">set_charge_relaxation</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span> <span class="o">=</span> <span class="n">calculator</span>
        <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
            <span class="n">calculator</span><span class="o">.</span><span class="n">set_charge_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


    </div>
<div class="viewcode-block" id="ChargeRelaxation.set_relaxation"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">set_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relaxation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the relaxation method.</span>
<span class="sd">            </span>
<span class="sd">            The method also creates a dictionary of parameters initialized to 0.0</span>
<span class="sd">            by invoking :meth:`~pysic.ChargeRelaxation.initialize_parameters`.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            relaxation: string</span>
<span class="sd">                a keyword specifying the mode of charge relaxation</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_modes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">relaxation</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span> <span class="o">=</span> <span class="n">relaxation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_parameters</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidRelaxationError</span><span class="p">(</span><span class="s">&quot;no such relaxation mode &quot;</span><span class="o">+</span><span class="n">relaxation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ChargeRelaxation.initialize_parameters"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.initialize_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dictionary of parameters and initializes all values to 0.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">names_of_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

</div>
<div class="viewcode-block" id="ChargeRelaxation.set_parameters"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values for all parameters.</span>
<span class="sd">            </span>
<span class="sd">            Equivalent to :meth:`~pysic.ChargeRelaxation.set_parameter_values`</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            parameters: list of doubles</span>
<span class="sd">                list of values to be assigned to parameters</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_values</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ChargeRelaxation.set_parameter_values"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_parameter_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the numeric values for all parameters.                    </span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">                    </span>
<span class="sd">            parameters: list of doubles</span>
<span class="sd">                list of values to be assigned to parameters</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidRelaxationError</span><span class="p">(</span><span class="s">&quot;The relaxation mode &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span><span class="o">+</span><span class="s">&quot; requires &quot;</span><span class="o">+</span>
                                         <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; parameters.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>

</div>
<div class="viewcode-block" id="ChargeRelaxation.set_parameter_value"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a given parameter to the desired value.</span>
<span class="sd">                    </span>
<span class="sd">            Parameters:</span>
<span class="sd">                        </span>
<span class="sd">            parameter_name: string</span>
<span class="sd">                name of the parameter</span>
<span class="sd">            value: double</span>
<span class="sd">                the new value of the parameter</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    </div>
<div class="viewcode-block" id="ChargeRelaxation.get_calculator"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.get_calculator">[docs]</a>    <span class="k">def</span> <span class="nf">get_calculator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the :class:`~pysic.Pysic` calculator assigned to this :class:`~pysic.ChargeRelaxation`.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span>
    </div>
<div class="viewcode-block" id="ChargeRelaxation.get_relaxation"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.get_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">get_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the keyword specifying the mode of relaxation.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span>
    </div>
<div class="viewcode-block" id="ChargeRelaxation.get_parameters"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.get_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing the numeric values of the parameters.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        
    </div>
<div class="viewcode-block" id="ChargeRelaxation.set_atoms"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.set_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">pass_to_calculator</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lets the relaxation algorithm know the atomic structure to be updated.</span>
<span class="sd">            </span>
<span class="sd">            The relaxation algorithm always works with the structure stored in the</span>
<span class="sd">            :class:`~pysic.Pysic` calculator it knows. If ``pass_to_calculator = True``,</span>
<span class="sd">            this method also updates the structure known by the calculator. However,</span>
<span class="sd">            this is not the main purpose of letting the :class:`~pysic.ChargeRelaxation`</span>
<span class="sd">            know the structure -</span>
<span class="sd">            it is not even necessary that the structure known by the relaxation algorithm</span>
<span class="sd">            is the same as that known by the calculator.</span>
<span class="sd">            </span>
<span class="sd">            The structure given to the algorithm is the structure whose charges it </span>
<span class="sd">            automatically updates after relaxing the charges in</span>
<span class="sd">            :meth:`~pysic.ChargeRelaxation.charge_relaxation`. In other words, if no</span>
<span class="sd">            structure is given, the relaxation will update the charges in the strucure</span>
<span class="sd">            known by :class:`~pysic.Pysic`, but this is always just a copy and so the</span>
<span class="sd">            original structure is left untouched.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            atoms: `ASE Atoms`_ object</span>
<span class="sd">                The system whose charges are to be relaxed. </span>
<span class="sd">                Note! The relaxation is always done using the atoms copy in </span>
<span class="sd">                :class:`~pysic.Pysic`, but if the original structure needs to be</span>
<span class="sd">                updated as well, the relaxation algorithm must have access to it.</span>
<span class="sd">            pass_to_calculator: logical</span>
<span class="sd">                if True, the atoms are also set for the calculator via </span>
<span class="sd">                :meth:`~pysic.Pysic.set_atoms`</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span>
        <span class="k">if</span> <span class="n">pass_to_calculator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="ChargeRelaxation.get_atoms"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the atoms object known by the algorithm.</span>
<span class="sd">            </span>
<span class="sd">        This is the `ASE Atoms`_ which will be automatically updated when</span>
<span class="sd">        charge relaxation is invoked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span>
    
    <span class="c"># ToDo: save charge velocities</span>
    <span class="c"># ToDo: compare performance to pure Fortran dynamics</span></div>
<div class="viewcode-block" id="ChargeRelaxation.charge_relaxation"><a class="viewcode-back" href="../chargerelaxation class.html#pysic.ChargeRelaxation.charge_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">charge_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the charge relaxation.</span>

<span class="sd">            The relaxation is always performed on the system associated with</span>
<span class="sd">            the :class:`~pysic.Pysic` calculator joint with this :class:`~pysic.ChargeRelaxation`.</span>
<span class="sd">            The calculated equilibrium charges are returned as a numeric array.</span>
<span class="sd">            </span>
<span class="sd">            If an `ASE Atoms`_ structure is known by the </span>
<span class="sd">            :class:`~pysic.ChargeRelaxation` </span>
<span class="sd">            (given through :meth:`~pysic.ChargeRelaxation.set_atoms`), the charges of</span>
<span class="sd">            the structure are updated according to the calculation result.</span>
<span class="sd">            If the structure is not known, the charges are updated in the</span>
<span class="sd">            structure stored in the :class:`~pysic.Pysic` calculator, but not in any other</span>
<span class="sd">            object. Since :class:`~pysic.Pysic` only stores a copy of the structure it </span>
<span class="sd">            is given, the original `ASE Atoms`_ object will not be updated.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="n">atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()</span>
        <span class="n">charges</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="c"># starting charges</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relaxation</span> <span class="o">==</span> <span class="n">ChargeRelaxation</span><span class="o">.</span><span class="n">relaxation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c"># damped dynamic relaxation</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;timestep&#39;</span><span class="p">]</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">dt</span>
            <span class="n">mq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;inertia&#39;</span><span class="p">]</span>
            <span class="n">inv_mq</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mq</span>
            <span class="n">n_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;n_steps&#39;</span><span class="p">]</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;tolerance&#39;</span><span class="p">]</span>
            <span class="n">friction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;friction&#39;</span><span class="p">]</span>
            <span class="n">future_friction</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">friction</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

            <span class="n">error</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">tolerance</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">charge_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="p">)</span> <span class="c"># starting &quot;velocities&quot; \dot{q}</span>
            <span class="n">charge_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">get_electronegativity_differences</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
            
            <span class="k">while</span> <span class="p">(</span><span class="n">error</span> <span class="o">&gt;</span> <span class="n">tolerance</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">n_steps</span><span class="p">):</span>
                <span class="n">charges</span> <span class="o">+=</span> <span class="n">charge_rates</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> \
                           <span class="p">(</span><span class="n">charge_forces</span> <span class="o">-</span> <span class="n">friction</span> <span class="o">*</span> <span class="n">charge_rates</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_mq</span> <span class="o">*</span> <span class="n">dt2</span>
                <span class="n">charge_rates</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">friction</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">charge_rates</span> <span class="o">+</span> \
                            <span class="n">charge_forces</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">inv_mq</span> <span class="o">*</span> <span class="n">dt</span>

                <span class="n">atoms</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
                <span class="n">charge_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculator</span><span class="o">.</span><span class="n">get_electronegativity_differences</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
            
                <span class="n">charge_rates</span> <span class="o">=</span> <span class="n">future_friction</span> <span class="o">*</span> \
                            <span class="p">(</span> <span class="n">charge_rates</span> <span class="o">+</span> <span class="n">charge_forces</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">inv_mq</span> <span class="o">*</span> <span class="n">dt</span> <span class="p">)</span>

                <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">charge_forces</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">charges</span>

</div></div>
<div class="viewcode-block" id="FastNeighborList"><a class="viewcode-back" href="../fastneighborlist class.html#pysic.FastNeighborList">[docs]</a><span class="k">class</span> <span class="nc">FastNeighborList</span><span class="p">(</span><span class="n">nbl</span><span class="o">.</span><span class="n">NeighborList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ASE has a neighbor list class built in, but its implementation is</span>
<span class="sd">        currently inefficient, and building of the list is an :math:`O(n^2)`</span>
<span class="sd">        operation. This neighbor list class overrides the </span>
<span class="sd">        :meth:`~pysic_utility.FastNeighborList.build` method with</span>
<span class="sd">        an :math:`O(n)` time routine. The fast routine is based on a</span>
<span class="sd">        spatial partitioning algorithm.</span>
<span class="sd">        </span>
<span class="sd">        The way cutoffs are handled is also somewhat different to the original</span>
<span class="sd">        ASE list. In ASE, the distances for two atoms are compared against</span>
<span class="sd">        the sum of the individual cutoffs + neighbor list skin. This list, however,</span>
<span class="sd">        searches for the neighbors of each atom at a distance of the cutoff of the</span>
<span class="sd">        given atom only, plus skin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">,</span> <span class="n">skin</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">neighbor_marginal</span><span class="p">):</span>
        <span class="n">nbl</span><span class="o">.</span><span class="n">NeighborList</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                              <span class="n">cutoffs</span><span class="o">=</span><span class="n">cutoffs</span><span class="p">,</span> 
                              <span class="n">skin</span><span class="o">=</span><span class="n">skin</span><span class="p">,</span> 
                              <span class="nb">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                              <span class="n">self_interaction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">bothways</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
    
<div class="viewcode-block" id="FastNeighborList.build"><a class="viewcode-back" href="../fastneighborlist class.html#pysic.FastNeighborList.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds the neighbor list.</span>
<span class="sd">            </span>
<span class="sd">            The routine requires that the given atomic structure matches</span>
<span class="sd">            the one in the core. This is because the method invokes the</span>
<span class="sd">            Fortran core to do the neighbor search.</span>
<span class="sd">            The method overrides the similar</span>
<span class="sd">            method in the original ASE neighborlist class, which directly operates</span>
<span class="sd">            on the given structure, so this method also takes the atomic structure </span>
<span class="sd">            as an argument. However, in order to keep the core modification routines in</span>
<span class="sd">            the :class:`~pysic.Pysic` class, this method does not change the core</span>
<span class="sd">            structure. It does raise an error if the structures do not match, though.</span>
<span class="sd">            </span>
<span class="sd">            The neighbor search is done via the :meth:`generate_neighbor_lists` routine.</span>
<span class="sd">            The routine builds the neighbor list in the core, after which the list is</span>
<span class="sd">            fed back to the :class:`~pysic.FastNeighborList` object by looping over all</span>
<span class="sd">            atoms and saving the lists of neighbors and offsets.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            atoms: ASE Atoms object</span>
<span class="sd">                the structure for which the neighbors are searched</span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">atoms_ready</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingAtomsError</span><span class="p">(</span><span class="s">&quot;Atoms in the core do not match.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingAtomsError</span><span class="p">(</span><span class="s">&quot;Atoms in the core do not match.&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span>
        
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">generate_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoffs</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
            <span class="n">n_nbs</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_neighbors_of_atom</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_nbs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_neighbor_list_of_atom</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">n_nbs</span><span class="p">)</span>
                <span class="c"># the offsets are in Fortran array format, so they need to be transposed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">nupdates</span> <span class="o">+=</span> <span class="mi">1</span>
        
</div></div>
<div class="viewcode-block" id="CoreMirror"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror">[docs]</a><span class="k">class</span> <span class="nc">CoreMirror</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class representing the status of the core.</span>

<span class="sd">    Whenever data is being passed over to the core for calculation,</span>
<span class="sd">    it should also be saved in the CoreMirror. This makes the CoreMirror</span>
<span class="sd">    reflect the current status of the core. Then, when something needs to be</span>
<span class="sd">    calculated, the :class:`~pysic.Pysic` calculator can simply check that</span>
<span class="sd">    it contains the same system as the CoreMirror to ensure that the</span>
<span class="sd">    core operates on the correct data.</span>

<span class="sd">    All data given to CoreMirror is saved as deep copies, i.e., not as</span>
<span class="sd">    the objects themselves but objects with exactly the same contents.</span>
<span class="sd">    This way if the original objects are modified, the ones in CoreMirror</span>
<span class="sd">    are not. This is the proper way to work, since the Fortran core</span>
<span class="sd">    obviously does not change without pushing the changes in the Python</span>
<span class="sd">    side to the core first.</span>

<span class="sd">        </span>
<span class="sd">    Since exactly one CoreMirror should exist during the simulation, </span>
<span class="sd">    deletion of the instance (which should happen at program termination automatically)</span>
<span class="sd">    will automatically trigger release of memory in the Fortran core</span>
<span class="sd">    as well as termination of the MPI framework.</span>
<span class="sd">        </span>
<span class="sd">    .. _ASE Atoms: https://wiki.fysik.dtu.dk/ase/ase/atoms.html</span>
<span class="sd">    .. _ASE NeighborList: https://wiki.fysik.dtu.dk/ase/ase/calculators/calculators.html#building-neighbor-lists</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoffs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_order_factor_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_ready</span> <span class="o">=</span> <span class="bp">False</span>
        

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">finish_mpi</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;CoreMirror()&quot;</span>


<div class="viewcode-block" id="CoreMirror.get_atoms"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the `ASE Atoms`_ structure stored in the CoreMirror.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>

</div>
<div class="viewcode-block" id="CoreMirror.view_fortran"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.view_fortran">[docs]</a>    <span class="k">def</span> <span class="nf">view_fortran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print some information on the data allocated in the Fortran core.</span>

<span class="sd">        This is mainly a debugging utility for directly seeing the status of the core.</span>
<span class="sd">        It can be accessed through::</span>

<span class="sd">           &gt;&gt;&gt; pysic.Pysic.core.view_fortran()</span>

<span class="sd">        The result is a bunch of data dumped to stdout. The function does</span>
<span class="sd">        not return anything.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">examine_atoms</span><span class="p">()</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">examine_cell</span><span class="p">()</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">examine_potentials</span><span class="p">()</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">examine_bond_order_factors</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="CoreMirror.set_atoms"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the entire `ASE Atoms`_ instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            atomic structure to be saved&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="CoreMirror.set_charges"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_charges">[docs]</a>    <span class="k">def</span> <span class="nf">set_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charges</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the charges of atoms in the `ASE Atoms`_ instance.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            atoms: `ASE Atoms`_ object</span>
<span class="sd">                atomic structure containing the positions to be saved.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="CoreMirror.set_atomic_positions"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_atomic_positions">[docs]</a>    <span class="k">def</span> <span class="nf">set_atomic_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the positions of atoms in the `ASE Atoms`_ instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            atomic structure containing the positions to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span>
        </div>
<div class="viewcode-block" id="CoreMirror.set_atomic_momenta"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_atomic_momenta">[docs]</a>    <span class="k">def</span> <span class="nf">set_atomic_momenta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the momenta of atoms in the `ASE Atoms`_ instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            atomic structure containing the momenta to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_momenta</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">())</span>
        </div>
<div class="viewcode-block" id="CoreMirror.set_cell"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_cell">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the supercell in the `ASE Atoms`_ instance.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            atomic structure containing the supercell to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">())</span>
        </div>
<div class="viewcode-block" id="CoreMirror.set_potentials"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">set_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potentials</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores :class:`~pysic.Potential` potentials.</span>

<span class="sd">        The :class:`~pysic.Potential` instances are copied as a whole,</span>
<span class="sd">        so any possible :class:`~pysic.Coordinator` and</span>
<span class="sd">        :class:`~pysic.BondOrderParameters` objects are also stored.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: list of :class:`~pysic.Potential` objects</span>
<span class="sd">            Potentials to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">potentials</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="CoreMirror.set_neighbor_lists"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_neighbor_lists">[docs]</a>    <span class="k">def</span> <span class="nf">set_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lists</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the neighbor lists.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE NeighborList`_ object</span>
<span class="sd">            Neighbor lists to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">lists</span><span class="p">)</span>

        </div>
<div class="viewcode-block" id="CoreMirror.set_coulomb"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.set_coulomb">[docs]</a>    <span class="k">def</span> <span class="nf">set_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coulomb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies and stores the Coulomb summation algorithm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            </span>
<span class="sd">        coulomb: :class:`~pysic.CoulombSummation`</span>
<span class="sd">            Coulomb summation algorithm to be saved            </span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">coulomb</span><span class="p">)</span>
    
    </div>
<div class="viewcode-block" id="CoreMirror.atoms_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.atoms_ready">[docs]</a>    <span class="k">def</span> <span class="nf">atoms_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the positions and momenta of the given atoms match those in the core.</span>

<span class="sd">        True is returned if the structures match, False otherwise.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            The atoms to be compared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_atomic_numbers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_atomic_numbers</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
    
        <span class="k">return</span> <span class="bp">True</span>
                        </div>
<div class="viewcode-block" id="CoreMirror.charges_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.charges_ready">[docs]</a>    <span class="k">def</span> <span class="nf">charges_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the charges of the given atoms match those in the core.</span>
<span class="sd">            </span>
<span class="sd">            True is returned if the charges match, False otherwise.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            atoms: `ASE Atoms`_ object</span>
<span class="sd">                The atoms to be compared.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_charges</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="bp">True</span>
            </div>
<div class="viewcode-block" id="CoreMirror.cell_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.cell_ready">[docs]</a>    <span class="k">def</span> <span class="nf">cell_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the given supercell matches that in the core.</span>

<span class="sd">        True is returned if the structures match, False otherwise.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            The cell to be compared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="CoreMirror.potentials_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.potentials_ready">[docs]</a>    <span class="k">def</span> <span class="nf">potentials_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the given potentials match those in the core.</span>

<span class="sd">        True is returned if the potentials match, False otherwise.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: list of :class:`~pysic.Potential` objects</span>
<span class="sd">            The potentials to be compared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pots</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">==</span> <span class="n">pots</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CoreMirror.neighbor_lists_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.neighbor_lists_ready">[docs]</a>    <span class="k">def</span> <span class="nf">neighbor_lists_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lists</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the given neighbor lists match those in the core.</span>

<span class="sd">        True is returned if the structures match, False otherwise.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE NeighborList`_ object</span>
<span class="sd">            The neighbor lists to be compared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists</span> <span class="o">==</span> <span class="n">lists</span>

            
            

            </div>
<div class="viewcode-block" id="CoreMirror.coulomb_summation_ready"><a class="viewcode-back" href="../coremirror class.html#pysic.CoreMirror.coulomb_summation_ready">[docs]</a>    <span class="k">def</span> <span class="nf">coulomb_summation_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coulomb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the given Coulomb summation matches that in the core.</span>
<span class="sd">            </span>
<span class="sd">            True is returned if the summation algorithms match, False otherwise.</span>
<span class="sd">            </span>
<span class="sd">            Parameters: :class:`~pysic.CoulombSummation`</span>
<span class="sd">                the summation algorithm to be compared</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">==</span> <span class="n">coulomb</span>

</div></div>
<div class="viewcode-block" id="Pysic"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic">[docs]</a><span class="k">class</span> <span class="nc">Pysic</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A calculator class providing the necessary methods for interfacing with `ASE`_.</span>

<span class="sd">    Pysic is a calculator for evaluating energies and forces for given atomic structures</span>
<span class="sd">    according to the given :class:`~pysic.Potential` set. Neither the geometry nor the</span>
<span class="sd">    potentials have to be specified upon creating the calculator, as they can be specified</span>
<span class="sd">    or changed later. They are necessary for actual calculation, of course.</span>

<span class="sd">    Simulation geometries must be defined as `ASE Atoms`_. This object contains both the</span>
<span class="sd">    atomistic coordinates and supercell parameters.</span>

<span class="sd">    Potentials must be defined as a list of :class:`~pysic.Potential` objects. </span>
<span class="sd">    The total potential of the system is then the sum of the individual potentials.</span>
<span class="sd">    </span>
<span class="sd">    .. _ASE: https://wiki.fysik.dtu.dk/ase/</span>
<span class="sd">    .. _ASE Atoms: https://wiki.fysik.dtu.dk/ase/ase/atoms.html</span>

<span class="sd">    Parameters:</span>

<span class="sd">    atoms: `ASE Atoms`_ object</span>
<span class="sd">        an Atoms object containing the full simulation geometry</span>
<span class="sd">    potentials: list of :class:`~pysic.Potential` objects</span>
<span class="sd">        list of potentials for describing interactions</span>
<span class="sd">    force_initialization: boolean</span>
<span class="sd">        If true, calculations always fully initialize the Fortran core.</span>
<span class="sd">        If false, the Pysic tries to evaluate what needs updating by</span>
<span class="sd">        consulting the :data:`~pysic.Pysic.core` instance of :class:`~pysic.CoreMirror`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">core</span> <span class="o">=</span> <span class="n">CoreMirror</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;An object storing the data passed to the core.</span>

<span class="sd">    Whenever a :class:`~pysic.Pysic` calculator alters the Fortran core,</span>
<span class="sd">    it should also modify the :data:`~pysic.Pysic.core` object so that</span>
<span class="sd">    it is always a valid representation of the actual core.</span>
<span class="sd">    Then, whenever :class:`~pysic.Pysic` needs to check if the</span>
<span class="sd">    representation in the core is up to date, it only needs to compare</span>
<span class="sd">    against :data:`~pysic.Pysic.core` instead of accessing the</span>
<span class="sd">    Fortran core itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">potentials</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">charge_relaxation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">coulomb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">full_initialization</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cutoffs</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_potentials</span><span class="p">(</span><span class="n">potentials</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_charge_relaxation</span><span class="p">(</span><span class="n">charge_relaxation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coulomb_summation</span><span class="p">(</span><span class="n">coulomb</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force_core_initialization</span> <span class="o">=</span> <span class="n">full_initialization</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">structure</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()):</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">neighbor_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">potentials</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Pysic(atoms={atoms},potentials={pots},full_initialization={init})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">),</span>
                                                                                          <span class="n">pots</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">),</span>
                                                                                          <span class="n">init</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_core_initialization</span><span class="p">))</span>


<div class="viewcode-block" id="Pysic.core_initialization_is_forced"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.core_initialization_is_forced">[docs]</a>    <span class="k">def</span> <span class="nf">core_initialization_is_forced</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true if the core is always fully initialized, false otherwise.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_core_initialization</span>

</div>
<div class="viewcode-block" id="Pysic.force_core_initialization"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.force_core_initialization">[docs]</a>    <span class="k">def</span> <span class="nf">force_core_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">new_mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the core initialization mode.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        new_mode: logical</span>
<span class="sd">            true if full initialization is required, false if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">force_core_initialization</span> <span class="o">=</span> <span class="n">new_mode</span>

    </div>
<div class="viewcode-block" id="Pysic.calculation_required"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.calculation_required">[docs]</a>    <span class="k">def</span> <span class="nf">calculation_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                             <span class="n">quantities</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;forces&#39;</span><span class="p">,</span><span class="s">&#39;energy&#39;</span><span class="p">,</span><span class="s">&#39;stress&#39;</span><span class="p">,</span><span class="s">&#39;electronegativities&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Check if a calculation is required.</span>
<span class="sd">        </span>
<span class="sd">        When forces or energy are calculated, the calculator saves the</span>
<span class="sd">        result in case it is needed several times. This method tells</span>
<span class="sd">        if a wanted quantity is not yet calculated for the current</span>
<span class="sd">        structure and needs to be calculated explicitly. If a list of</span>
<span class="sd">        several quantities is given, the method returns true if any one of</span>
<span class="sd">        them needs to be calculated.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        atoms: `ASE Atoms`_ object</span>
<span class="sd">            ignored at the moment</span>
<span class="sd">        quantities: list of strings</span>
<span class="sd">            list of keywords &#39;energy&#39;, &#39;forces&#39;, &#39;stress&#39;, &#39;electronegativities&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">do_it</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="n">list_of_quantities</span> <span class="o">=</span> <span class="n">quantities</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">list_of_quantities</span> <span class="o">=</span> <span class="p">[</span> <span class="n">quantities</span> <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">list_of_quantities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mark</span> <span class="o">==</span> <span class="s">&#39;energy&#39;</span><span class="p">:</span>
                <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s">&#39;forces&#39;</span><span class="p">:</span>
                <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s">&#39;electronegativities&#39;</span><span class="p">:</span>
                <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s">&#39;stress&#39;</span><span class="p">:</span>
                <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c"># If the core does not match the Pysic calculator,</span>
        <span class="c"># we may have changed the system or potentials</span>
        <span class="c"># associated with the calculator without telling it.</span>
        <span class="c"># In that case the quantities need to be recalculated.</span>
        <span class="c"># It is of course possible that we have several Pysics</span>
        <span class="c"># changing the core which would lead to unnecessary</span>
        <span class="c"># recalculations.</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">atoms_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)):</span>
            <span class="c">#print &quot;atoms&quot;</span>
            <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">charges_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)):</span>
            <span class="c">#print &quot;charges&quot;</span>
            <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cell_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)):</span>
            <span class="c">#print &quot;cell&quot;</span>
            <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potentials_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">)):</span>
            <span class="c">#print &quot;potentials&quot;</span>
            <span class="n">do_it</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">do_it</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Pysic.get_atoms"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the `ASE Atoms`_ object assigned to the calculator.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>

</div>
<div class="viewcode-block" id="Pysic.get_neighbor_lists"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_neighbor_lists">[docs]</a>    <span class="k">def</span> <span class="nf">get_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the :class:`~pysic.FastNeighborList` or `ASE NeighborList`_ </span>
<span class="sd">        object assigned to the calculator.</span>

<span class="sd">        The neighbor lists are generated according to the given `ASE Atoms`_ object</span>
<span class="sd">        and the :class:`~pysic.Potential` objects of the calculator. Note that the lists</span>
<span class="sd">        are created when the core is set or if the method </span>
<span class="sd">        :meth:`~pysic.Pysic.create_neighbor_lists` is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span>

</div>
<div class="viewcode-block" id="Pysic.get_potentials"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">get_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of potentials assigned to the calculator.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span>

    
    </div>
<div class="viewcode-block" id="Pysic.get_electronegativities"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_electronegativities">[docs]</a>    <span class="k">def</span> <span class="nf">get_electronegativities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the electronegativities of atoms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_required</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="s">&#39;electronegativities&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_electronegativities</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span>
    
</div>
<div class="viewcode-block" id="Pysic.get_electronegativity_differences"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_electronegativity_differences">[docs]</a>    <span class="k">def</span> <span class="nf">get_electronegativity_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the electronegativity differences of atoms from the average of the entire system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">enegs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_electronegativities</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">average_eneg</span> <span class="o">=</span> <span class="n">enegs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">enegs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enegs</span> <span class="o">-</span> <span class="n">average_eneg</span>

    </div>
<div class="viewcode-block" id="Pysic.get_forces"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_forces">[docs]</a>    <span class="k">def</span> <span class="nf">get_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the forces.</span>

<span class="sd">        If the atoms parameter is given, it will be used for updating the</span>
<span class="sd">        structure assigned to the calculator prior to calculating the forces.</span>
<span class="sd">        Otherwise the structure already associated with the calculator is used.</span>

<span class="sd">        The calculator checks if the forces have been calculated already</span>
<span class="sd">        via :meth:`~pysic.Pysic.calculation_required`. If the structure</span>
<span class="sd">        has changed, the forces are calculated using :meth:`~pysic.Pysic.calculate_forces`</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE atoms`_ object</span>
<span class="sd">            the structure for which the forces are determined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_required</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="s">&#39;forces&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_forces</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces</span>

</div>
<div class="viewcode-block" id="Pysic.get_potential_energy"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_potential_energy">[docs]</a>    <span class="k">def</span> <span class="nf">get_potential_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force_consistent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the potential energy.</span>

<span class="sd">        If the atoms parameter is given, it will be used for updating the</span>
<span class="sd">        structure assigned to the calculator prior to calculating the energy.</span>
<span class="sd">        Otherwise the structure already associated with the calculator is used.</span>

<span class="sd">        The calculator checks if the energy has been calculated already</span>
<span class="sd">        via :meth:`~pysic.Pysic.calculation_required`. If the structure</span>
<span class="sd">        has changed, the energy is calculated using :meth:`~pysic.Pysic.calculate_energy`</span>

<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE atoms`_ object</span>
<span class="sd">            the structure for which the energy is determined</span>
<span class="sd">        force_consistent: logical</span>
<span class="sd">            ignored at the moment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_required</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="s">&#39;energy&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_energy</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span>

</div>
<div class="viewcode-block" id="Pysic.get_stress"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_stress">[docs]</a>    <span class="k">def</span> <span class="nf">get_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the stress tensor in the format </span>
<span class="sd">        :math:`[\sigma_{xx},\sigma_{yy},\sigma_{zz},\sigma_{yz},\sigma_{xz},\sigma_{xy}]`</span>

<span class="sd">        If the atoms parameter is given, it will be used for updating the</span>
<span class="sd">        structure assigned to the calculator prior to calculating the stress.</span>
<span class="sd">        Otherwise the structure already associated with the calculator is used.</span>

<span class="sd">        The calculator checks if the stress has been calculated already</span>
<span class="sd">        via :meth:`~pysic.Pysic.calculation_required`. If the structure</span>
<span class="sd">        has changed, the stress is calculated using :meth:`~pysic.Pysic.calculate_stress`</span>

<span class="sd">        Stress (potential part) and force are evaluated in tandem. </span>
<span class="sd">        Therefore, invoking the evaluation of</span>
<span class="sd">        one automatically leads to the evaluation of the other. Thus, if you have just</span>
<span class="sd">        evaluated the forces, the stress will already be known.</span>
<span class="sd">    </span>
<span class="sd">        This is because the</span>
<span class="sd">        stress tensor is formally defined as</span>
<span class="sd">            </span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">            \\sigma_{AB} = -\\frac{1}{V} \\sum_i \\left[ m_i (v_i)_A (v_i)_B + (r_i)_A (f_i)_B \\right],</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        where :math:`m`, :math:`v`, :math:`r`, and :math:`f` are mass, velocity,</span>
<span class="sd">        position and force of atom :math:`i`, and :math:`A`, :math:`B` denote the</span>
<span class="sd">        cartesian coordinates :math:`x,y,z`. </span>
<span class="sd">        (The minus sign is there just to be consistent with the NPT routines in `ASE`_.) </span>
<span class="sd">        However, if periodic boundaries are used,</span>
<span class="sd">        the absolute coordinates cannot be used (there would be discontinuities at the</span>
<span class="sd">        boundaries of the simulation cell). Instead, the potential energy terms </span>
<span class="sd">        :math:`(r_i)_A (f_i)_B` must be evaluated locally for pair, triplet, and many</span>
<span class="sd">        body forces using the relative coordinates of the particles involved in the</span>
<span class="sd">        local interactions. These coordinates are only available during the actual force</span>
<span class="sd">        evaluation when the local interactions are looped over. Thus, calculating the stress</span>
<span class="sd">        requires doing the full force evaluation cycle. On the other hand, calculating the</span>
<span class="sd">        stress is not a great effort compared to the force evaluation, so it is convenient</span>
<span class="sd">        to evaluate the stress always when the forces are evaluated.</span>
<span class="sd">                        </span>
<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE atoms`_ object</span>
<span class="sd">            the structure for which the stress is determined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_required</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="s">&#39;stress&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stress</span><span class="p">()</span>
        
        <span class="c"># self.stress contains the potential contribution to the stress tensor</span>
        <span class="c"># but we add the kinetic contribution on the fly</span>
        <span class="n">momenta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">()</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_masses</span><span class="p">()</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span> <span class="n">momenta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">masses</span><span class="p">,</span><span class="n">masses</span><span class="p">,</span><span class="n">masses</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="p">)</span>

        <span class="n">kinetic_stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
        
        <span class="c"># s_xx, s_yy, s_zz, s_yz, s_xz, s_xy</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kinetic_stress</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">momenta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
                
        <span class="c"># ASE NPT simulator wants the pressure with an inversed sign</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span> <span class="n">kinetic_stress</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span>

    </div>
<div class="viewcode-block" id="Pysic.set_atoms"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns the calculator with the given structure.</span>
<span class="sd">            </span>
<span class="sd">        This method is always called when any method is given the</span>
<span class="sd">        atomic structure as an argument. If the argument is missing</span>
<span class="sd">        or None, nothing is done. Otherwise a copy of the given structure</span>
<span class="sd">        is saved (according to the instructions in </span>
<span class="sd">        `ASE API &lt;https://wiki.fysik.dtu.dk/ase/ase/calculators/calculators.html#calculator-interface&gt;`_.)</span>
<span class="sd">            </span>
<span class="sd">        If a structure is already in memory and it is different to the given</span>
<span class="sd">        one (as compared with ``__ne__``), it is noted that all quantities</span>
<span class="sd">        are unknown for the new system. If the structure is the same as the</span>
<span class="sd">        one already known, nothing is done.</span>
<span class="sd">        This is because if one wants to</span>
<span class="sd">        access the energy of forces of the same system repeatedly, it is unnecessary</span>
<span class="sd">        to always calculate them from scratch. Therefore the calculator saves</span>
<span class="sd">        the computed values along with a flag stating that the values have been</span>
<span class="sd">        computed.</span>
<span class="sd">            </span>
<span class="sd">        Parameters:</span>

<span class="sd">        atoms: `ASE atoms`_ object</span>
<span class="sd">            the structure to be calculated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">atoms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">!=</span> <span class="n">atoms</span> <span class="ow">or</span>
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_charges</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>
                

                <span class="c"># NB: this avoids updating the potential lists every time an atom moves</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_atomic_numbers</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_atomic_numbers</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
                        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">False</span>

                    <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span> <span class="o">!=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_tags</span><span class="p">())</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
                        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">False</span>                

                    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potentials_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">)):</span>
                        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">False</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">False</span>
            

                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Pysic.set_potentials"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">set_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potentials</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign a list of potentials to the calculator.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        potentials: list of :class:`~pysic.Potential` objects</span>
<span class="sd">            a list of potentials to describe interactinos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">potentials</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>
            
            <span class="n">new_cutoffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_expanded</span><span class="p">(</span><span class="n">new_cutoffs</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">potentials</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">potentials</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="p">[</span><span class="n">potentials</span><span class="p">]</span>
    
    </div>
<div class="viewcode-block" id="Pysic.add_potential"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.add_potential">[docs]</a>    <span class="k">def</span> <span class="nf">add_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potential</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a potential to the list of potentials.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        potential: :class:`~pysic.Potential` object</span>
<span class="sd">            a new potential to describe interactions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_cutoffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_expanded</span><span class="p">(</span><span class="n">new_cutoffs</span><span class="p">)</span>
        
    </div>
<div class="viewcode-block" id="Pysic.set_coulomb_summation"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_coulomb_summation">[docs]</a>    <span class="k">def</span> <span class="nf">set_coulomb_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coulomb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the Coulomb summation algorithm for the calculator.</span>
<span class="sd">            </span>
<span class="sd">            If a Coulomb summation algorithm is set, the Coulomb interactions</span>
<span class="sd">            between all charged atoms are evaluated automatically during</span>
<span class="sd">            energy and force evaluation. If not, the charges do not directly</span>
<span class="sd">            interact.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            coulomb: :class:`~pysic.CoulombSummation`</span>
<span class="sd">                the Coulomb summation algorithm</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">coulomb</span>
        <span class="n">new_cutoffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_expanded</span><span class="p">(</span><span class="n">new_cutoffs</span><span class="p">)</span>
    
</div>
<div class="viewcode-block" id="Pysic.get_coulomb_summation"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_coulomb_summation">[docs]</a>    <span class="k">def</span> <span class="nf">get_coulomb_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the Coulomb summation algorithm of this calculator.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span>
    
    </div>
<div class="viewcode-block" id="Pysic.set_charge_relaxation"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_charge_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">set_charge_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">charge_relaxation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a charge relaxation algorithm to the calculator.</span>
<span class="sd">            </span>
<span class="sd">            If a charge relaxation scheme has been added to the :class:`~pysic.Pysic`</span>
<span class="sd">            calculator, it will be automatically asked to do the charge relaxation </span>
<span class="sd">            before the calculation of energies or forces via </span>
<span class="sd">            :meth:`~pysic.ChargeRelaxation.charge_relaxation`.</span>
<span class="sd">            </span>
<span class="sd">            It is also possible to pass the :class:`~pysic.Pysic` calculator to the </span>
<span class="sd">            :class:`~pysic.ChargeRelaxation` algorithm without creating the opposite</span>
<span class="sd">            link using :meth:`~pysic.ChargeRelaxation.set_calculator`. </span>
<span class="sd">            In that case, the calculator does not automatically relax the charges, but</span>
<span class="sd">            the user can manually trigger the relaxation with </span>
<span class="sd">            :meth:`~pysic.ChargeRelaxation.charge_relaxation`.</span>
<span class="sd">            </span>
<span class="sd">            If you wish to remove automatic charge relaxation, just call this method</span>
<span class="sd">            again with None as argument.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            charge_relaxation: :class:`~pysic.ChargeRelaxation` object</span>
<span class="sd">                the charge relaxation algorithm</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">charge_relaxation</span><span class="o">.</span><span class="n">set_calculator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reciprocal</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span> <span class="o">=</span> <span class="n">charge_relaxation</span>

                </div>
<div class="viewcode-block" id="Pysic.get_charge_relaxation"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_charge_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">get_charge_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the :class:`~pysic.ChargeRelaxation` object connected to the calculator.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span>
    
    </div>
<div class="viewcode-block" id="Pysic.create_neighbor_lists"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.create_neighbor_lists">[docs]</a>    <span class="k">def</span> <span class="nf">create_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoffs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">marginal</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">neighbor_marginal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the neighbor lists.</span>

<span class="sd">        In order to do calculations at reasonable speed, the calculator needs </span>
<span class="sd">        a list of neighbors for each atom. For this purpose, the `ASE NeighborList`_</span>
<span class="sd">        are used. This method initializes these lists according to the given</span>
<span class="sd">        cutoffs.</span>

<span class="sd">        .. _ASE NeighborList: https://wiki.fysik.dtu.dk/ase/ase/calculators/calculators.html#building-neighbor-lists</span>

<span class="sd">        Parameters:</span>

<span class="sd">        cutoffs: list of doubles</span>
<span class="sd">            a list containing the cutoff distance for each atom</span>
<span class="sd">        marginal: double</span>
<span class="sd">            the skin width of the neighbor list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fastlist</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">cutoffs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cutoffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">max_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">other_vec1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">other_vec2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">other_vec1</span><span class="p">,</span><span class="n">other_vec2</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="n">normal</span><span class="p">))</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="n">normal</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">max_cut</span><span class="p">:</span>
                <span class="n">fastlist</span> <span class="o">=</span> <span class="bp">False</span>
                
        <span class="k">if</span> <span class="n">fastlist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span> <span class="o">=</span> <span class="n">FastNeighborList</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span><span class="n">skin</span><span class="o">=</span><span class="n">marginal</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">fastlist</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fastlist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span> <span class="o">=</span> <span class="n">nbl</span><span class="o">.</span><span class="n">NeighborList</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span><span class="n">skin</span><span class="o">=</span><span class="n">marginal</span><span class="p">,</span><span class="nb">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">self_interaction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bothways</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoffs</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Pysic.get_individual_cutoffs"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_individual_cutoffs">[docs]</a>    <span class="k">def</span> <span class="nf">get_individual_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaler</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of maximum cutoffs for all atoms.</span>

<span class="sd">        For each atom, the interaction with the longest cutoff is found and</span>
<span class="sd">        the associated maximum cutoffs are returned as a list. In case the a list</span>
<span class="sd">        of scaled values are required, the scaler can be adjusted. E.g., scaler = 0.5</span>
<span class="sd">        will return the cutoffs halved.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        scaler: double</span>
<span class="sd">            a number for scaling all values in the generated list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">get_realspace_cutoff</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cuts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># loop over all atoms, with symbol, tags, index containing the corresponding</span>
            <span class="c"># info for a single atom at a time</span>
            <span class="k">for</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_tags</span><span class="p">(),</span>
                                           <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">())):</span>
            
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">max_cut</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_cut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">get_realspace_cutoff</span><span class="p">()</span>
                
                <span class="k">for</span> <span class="n">potential</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">:</span>
                    <span class="n">active_potential</span> <span class="o">=</span> <span class="bp">False</span>
                    
                    <span class="k">if</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_different_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_different_tags</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_different_indices</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">active_potential</span> <span class="o">=</span> <span class="bp">True</span>
                    
                    <span class="k">if</span> <span class="n">active_potential</span> <span class="ow">and</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_cut</span><span class="p">:</span>
                        <span class="n">max_cut</span> <span class="o">=</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">()</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">potential</span><span class="o">.</span><span class="n">get_coordinator</span><span class="p">()</span><span class="o">.</span><span class="n">get_bond_order_parameters</span><span class="p">():</span>
                            <span class="n">active_bond</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_different_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">active_bond</span> <span class="o">=</span> <span class="bp">True</span>
                                
                            <span class="k">if</span> <span class="n">active_bond</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_cut</span><span class="p">:</span>
                                    <span class="n">max_cut</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">()</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="n">cuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_cut</span><span class="o">*</span><span class="n">scaler</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cuts</span>

</div>
<div class="viewcode-block" id="Pysic.calculate_electronegativities"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.calculate_electronegativities">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_electronegativities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates electronegativities.</span>
<span class="sd">            </span>
<span class="sd">        Calls the Fortran core to calculate forces for the currently assigned structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_electronegativities</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="Pysic.calculate_forces"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.calculate_forces">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates forces (and the potential part of the stress tensor).</span>

<span class="sd">        Calls the Fortran core to calculate forces for the currently assigned structure.</span>
<span class="sd">            </span>
<span class="sd">        If a link exists to a :class:`~pysic.ChargeRelaxation`, it is first made to</span>
<span class="sd">        relax the atomic charges before the forces are calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="p">()</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_forces</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span><span class="c">#.transpose()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="Pysic.calculate_energy"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.calculate_energy">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the potential energy.</span>

<span class="sd">        Calls the Fortran core to calculate the potential energy for the currently assigned structure.</span>
<span class="sd"> </span>
<span class="sd">        If a link exists to a :class:`~pysic.ChargeRelaxation`, it is first made to</span>
<span class="sd">        relax the atomic charges before the forces are calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="p">()</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_energy</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Pysic.calculate_stress"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.calculate_stress">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the potential part of the stress tensor (and forces).</span>

<span class="sd">        Calls the Fortran core to calculate the stress tensor for the currently assigned structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="o">.</span><span class="n">charge_relaxation</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">calculate_forces</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Pysic.set_core"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_core">[docs]</a>    <span class="k">def</span> <span class="nf">set_core</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up the Fortran core for calculation.</span>

<span class="sd">        If the core is not initialized, if the number of atoms has changed, or</span>
<span class="sd">        if full initialization is forced, the core is initialized from scratch.</span>
<span class="sd">        Otherwise, only the atomic coordinates and momenta are updated.</span>
<span class="sd">        Potentials, neighbor lists etc. are also updated if they have been edited.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_core_initialization</span><span class="p">:</span>
            <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">mpi_ready</span><span class="p">:</span>
            <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">():</span>
            <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span> <span class="o">!=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">():</span>
            <span class="n">do_full_init</span> <span class="o">=</span> <span class="bp">True</span>
            
                        
        <span class="k">if</span> <span class="n">do_full_init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_fortran_core</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cell_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_supercell</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">atoms_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_coordinates</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">charges_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_charges</span><span class="p">()</span>
                    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potentials_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_potentials</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">coulomb_summation_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_core_coulomb</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_potential_lists</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">neighbor_lists_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_core_neighbor_lists</span><span class="p">()</span>
                
</div>
<div class="viewcode-block" id="Pysic.update_core_potential_lists"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_potential_lists">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_potential_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the potential lists.</span>

<span class="sd">        Since one often runs :class:`~pysic.Pysic` with a set of potentials,</span>
<span class="sd">        the core pre-analyzes which potentials affect each atom and saves a list</span>
<span class="sd">        of such potentials for every particle. This method asks the core to</span>
<span class="sd">        generate these lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">atoms_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingAtomsError</span><span class="p">(</span><span class="s">&quot;Creating potential lists before updating atoms in core.&quot;</span><span class="p">)</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">create_potential_list</span><span class="p">()</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">create_bond_order_factor_list</span><span class="p">()</span>
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Pysic.update_core_potentials"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates potentials for the Fortran core.&quot;&quot;&quot;</span>
                
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">potential_lists_ready</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_potentials</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_bond_order_factors</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_potentials</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_bond_order_factors</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">n_pots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">coord_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pot_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># count the number of separate potentials</span>
        <span class="k">for</span> <span class="n">pot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">:</span>

            <span class="c"># grab the coordinators associated with the potentials</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_coordinator</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">coord</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">coord_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">coord</span><span class="p">,</span><span class="n">pot_index</span><span class="p">])</span>
            <span class="n">pot_index</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_symbols</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
                    <span class="n">n_pots</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">different</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
                    <span class="n">n_pots</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">different</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_indices</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
                    <span class="n">n_pots</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">different</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_potentials</span><span class="p">(</span><span class="n">n_pots</span><span class="p">)</span>

        <span class="n">pot_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">:</span>
            
            <span class="n">group_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_coordinator</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">group_index</span> <span class="o">=</span> <span class="n">pot_index</span>
                <span class="n">pot</span><span class="o">.</span><span class="n">get_coordinator</span><span class="p">()</span><span class="o">.</span><span class="n">set_group_index</span><span class="p">(</span><span class="n">pot_index</span><span class="p">)</span>
            <span class="n">pot_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">n_targ</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_number_of_targets</span><span class="p">()</span>
            <span class="n">no_symbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">n_targ</span><span class="o">*</span><span class="p">[</span><span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="s">&#39;xx&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">no_tags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">n_targ</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">no_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">n_targ</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_symbols</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">int_orig_symbs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">orig_symbs</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                        <span class="n">int_orig_symbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="n">orig_symbs</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">symbs</span> <span class="ow">in</span> <span class="n">different</span><span class="p">:</span>
                        <span class="n">int_symbs</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">symbs</span><span class="p">:</span>
                            <span class="n">int_symbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

                        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">add_potential</span><span class="p">(</span><span class="n">pot</span><span class="o">.</span><span class="n">get_potential_type</span><span class="p">(),</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_parameter_values</span><span class="p">()</span> <span class="p">),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">(),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_soft_cutoff</span><span class="p">(),</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">int_symbs</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                                         <span class="n">no_tags</span><span class="p">,</span>
                                                         <span class="n">no_inds</span><span class="p">,</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">int_orig_symbs</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                                         <span class="n">no_tags</span><span class="p">,</span>
                                                         <span class="n">no_inds</span><span class="p">,</span>
                                                         <span class="n">group_index</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">orig_tags</span> <span class="o">=</span> <span class="n">targets</span>
                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">different</span><span class="p">:</span>
                        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">add_potential</span><span class="p">(</span><span class="n">pot</span><span class="o">.</span><span class="n">get_potential_type</span><span class="p">(),</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_parameter_values</span><span class="p">()</span> <span class="p">),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">(),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_soft_cutoff</span><span class="p">(),</span>
                                                         <span class="n">no_symbs</span><span class="p">,</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">tags</span> <span class="p">),</span>
                                                         <span class="n">no_inds</span><span class="p">,</span>
                                                         <span class="n">no_symbs</span><span class="p">,</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orig_tags</span><span class="p">),</span>
                                                         <span class="n">no_inds</span><span class="p">,</span>
                                                         <span class="n">group_index</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alltargets</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_indices</span><span class="p">()</span>                
                <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                    <span class="n">orig_inds</span> <span class="o">=</span> <span class="n">targets</span>
                    <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                    <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">inds</span> <span class="ow">in</span> <span class="n">different</span><span class="p">:</span>
                        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">add_potential</span><span class="p">(</span><span class="n">pot</span><span class="o">.</span><span class="n">get_potential_type</span><span class="p">(),</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">pot</span><span class="o">.</span><span class="n">get_parameter_values</span><span class="p">()</span> <span class="p">),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">(),</span>
                                                         <span class="n">pot</span><span class="o">.</span><span class="n">get_soft_cutoff</span><span class="p">(),</span>
                                                         <span class="n">no_symbs</span><span class="p">,</span>
                                                         <span class="n">no_tags</span><span class="p">,</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">inds</span> <span class="p">),</span>
                                                         <span class="n">no_symbs</span><span class="p">,</span>
                                                         <span class="n">no_tags</span><span class="p">,</span>
                                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orig_inds</span><span class="p">),</span>
                                                         <span class="n">group_index</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">n_bonds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">allbonds</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_bond_order_parameters</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">allbonds</span><span class="p">:</span>
                    <span class="n">alltargets</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_symbols</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>
                        <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                        <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
                        <span class="n">n_bonds</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">different</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_bond_order_factors</span><span class="p">(</span><span class="n">n_bonds</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">allbonds</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_bond_order_parameters</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">allbonds</span><span class="p">:</span>
                    <span class="n">alltargets</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_symbols</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">alltargets</span><span class="p">:</span>

                        <span class="n">int_orig_symbs</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">orig_symbs</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                            <span class="n">int_orig_symbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="n">orig_symbs</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
                        
                        <span class="n">perms</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                        <span class="n">different</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">symbs</span> <span class="ow">in</span> <span class="n">different</span><span class="p">:</span>
                            <span class="n">int_symbs</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">symbs</span><span class="p">:</span>
                                <span class="n">int_symbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

                            <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">add_bond_order_factor</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">get_bond_order_type</span><span class="p">(),</span>
                                                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_parameters_as_list</span><span class="p">()</span> <span class="p">),</span>
                                                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">bond</span><span class="o">.</span><span class="n">get_number_of_parameters</span><span class="p">()</span> <span class="p">),</span>
                                                                   <span class="n">bond</span><span class="o">.</span><span class="n">get_cutoff</span><span class="p">(),</span>
                                                                   <span class="n">bond</span><span class="o">.</span><span class="n">get_soft_cutoff</span><span class="p">(),</span>
                                                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">int_symbs</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">int_orig_symbs</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                                                   <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>


        <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">allocate_bond_order_storage</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span>
                                                       <span class="n">pot_index</span><span class="p">,</span>
                                                       <span class="nb">len</span><span class="p">(</span><span class="n">coord_list</span><span class="p">))</span>

        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_potentials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">)</span>

            </div>
<div class="viewcode-block" id="Pysic.update_core_coulomb"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_coulomb">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the Coulomb summation parameters in the Fortran core.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="n">CoulombSummation</span><span class="o">.</span><span class="n">summation_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c"># ewald summation</span>
                <span class="n">rcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;real_cutoff&#39;</span><span class="p">]</span>
                <span class="n">kcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;k_cutoff&#39;</span><span class="p">]</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;sigma&#39;</span><span class="p">]</span>
                <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;epsilon&#39;</span><span class="p">]</span>
                
                <span class="n">scales</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="o">.</span><span class="n">get_scaling_factors</span><span class="p">()</span>
                
                <span class="c"># calculate the truncation limits for the k-space sum</span>
                <span class="n">reci_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_reciprocal_cell</span><span class="p">()</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">k1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">kcut</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">volume</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">kcut</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">volume</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span>
                <span class="n">k3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">kcut</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reci_cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">volume</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span>

                <span class="k">if</span> <span class="n">scales</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span>
                <span class="k">elif</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()):</span>
                    <span class="k">raise</span> <span class="n">InvalidParametersError</span><span class="p">(</span><span class="s">&quot;Length of the scaling factor vector does not match the number of atoms.&quot;</span><span class="p">)</span>
                
                <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">set_ewald_parameters</span><span class="p">(</span><span class="n">rcut</span><span class="p">,</span>
                                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">]),</span>
                                                        <span class="n">sigma</span><span class="p">,</span>
                                                        <span class="n">epsilon</span><span class="p">,</span>
                                                        <span class="n">scales</span><span class="p">)</span>

                <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span><span class="p">)</span>
        
    </div>
<div class="viewcode-block" id="Pysic.update_core_coordinates"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the positions and momenta of atoms in the Fortran core.</span>

<span class="sd">        The core must be initialized and the number of atoms must match.</span>
<span class="sd">        Upon the update, it is automatically checked if the neighbor lists</span>
<span class="sd">        should be updated as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()</span> <span class="o">!=</span> <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">LockedCoreError</span><span class="p">(</span><span class="s">&quot;The number of atoms does not match.&quot;</span><span class="p">)</span>
        
        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">momenta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">update_atom_coordinates</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">momenta</span><span class="p">)</span>

        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_atomic_positions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_atomic_momenta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_neighbor_lists</span><span class="p">()</span>

                    
</div>
<div class="viewcode-block" id="Pysic.update_core_charges"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_charges">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates atomic charges in the core.&quot;&quot;&quot;</span>
        
        <span class="n">charges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronegativities</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">update_atom_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
        
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
            
            </div>
<div class="viewcode-block" id="Pysic.update_core_supercell"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_supercell">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_supercell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the supercell in the Fortran core.&quot;&quot;&quot;</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">periodicity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()</span> <span class="p">)</span>
        
        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">create_cell</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span><span class="n">inverse</span><span class="p">,</span><span class="n">periodicity</span><span class="p">)</span>
        
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_neighbor_lists</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            
</div>
<div class="viewcode-block" id="Pysic.update_core_neighbor_lists"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.update_core_neighbor_lists">[docs]</a>    <span class="k">def</span> <span class="nf">update_core_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the neighbor lists in the Fortran core.</span>

<span class="sd">         If uninitialized, the lists are created first via :meth:`~pysic.Pysic.create_neighbor_lists`.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">atoms_ready</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MissingAtomsError</span><span class="p">(</span><span class="s">&quot;Creating neighbor lists before updating atoms in the core.&quot;</span><span class="p">)</span>
        <span class="n">cutoffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_individual_cutoffs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_neighbor_lists</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cutoffs</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_lists_waiting</span> <span class="o">=</span> <span class="bp">True</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span><span class="p">,</span><span class="n">FastNeighborList</span><span class="p">):</span>
            <span class="c"># if we used the fast list, the core is already updated</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># if we have used the ASE list, it must be passed on to the core</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">()):</span>
                <span class="p">[</span><span class="n">nbors</span><span class="p">,</span><span class="n">offs</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>                
                <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">create_neighbor_list</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nbors</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">offs</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>

        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_neighbor_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbor_list</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="Pysic.initialize_fortran_core"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.initialize_fortran_core">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_fortran_core</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fully initializes the Fortran core, creating the atoms, supercell, potentials, and neighbor lists.&quot;&quot;&quot;</span>
        
        <span class="n">masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_masses</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">charges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">momenta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_momenta</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">str2ints</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">elements</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="c">#self.create_neighbor_lists(self.get_individual_cutoffs(1.0))</span>
        <span class="c">#self.neighbor_lists_waiting = True</span>

        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">create_atoms</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span><span class="n">charges</span><span class="p">,</span><span class="n">positions</span><span class="p">,</span><span class="n">momenta</span><span class="p">,</span><span class="n">tags</span><span class="p">,</span><span class="n">elements</span><span class="p">)</span>
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

        <span class="n">pf</span><span class="o">.</span><span class="n">pysic_interface</span><span class="o">.</span><span class="n">distribute_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">())</span>
        <span class="n">Pysic</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">mpi_ready</span> <span class="o">=</span> <span class="bp">True</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_supercell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_potentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_neighbor_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_potential_lists</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_core_coulomb</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="Pysic.get_numerical_energy_gradient"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_numerical_energy_gradient">[docs]</a>    <span class="k">def</span> <span class="nf">get_numerical_energy_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_index</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Numerically calculates the negative gradient of energy with respect to moving a single particle.</span>

<span class="sd">        This is for debugging the forces.&quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">atoms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="n">energy_xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="n">energy_xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">energy_xm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">shift</span>

        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="n">energy_yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">energy_ym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">shift</span>

        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="n">energy_zp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">energy_zm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">system</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">(</span><span class="n">orig_system</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span> <span class="o">-</span><span class="p">(</span><span class="n">energy_xp</span><span class="o">-</span><span class="n">energy_xm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">),</span>
                 <span class="o">-</span><span class="p">(</span><span class="n">energy_yp</span><span class="o">-</span><span class="n">energy_ym</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">),</span>
                 <span class="o">-</span><span class="p">(</span><span class="n">energy_zp</span><span class="o">-</span><span class="n">energy_zm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">)</span> <span class="p">]</span>


            </div>
<div class="viewcode-block" id="Pysic.set_cutoffs"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.set_cutoffs">[docs]</a>    <span class="k">def</span> <span class="nf">set_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy and save the list of individual cutoff radii.</span>
<span class="sd">            </span>
<span class="sd">            Parameters:</span>
<span class="sd">            </span>
<span class="sd">            cutoffs: list of doubles</span>
<span class="sd">            new cutoffs</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_cutoffs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">)</span>
            
            </div>
<div class="viewcode-block" id="Pysic.neighbor_lists_expanded"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.neighbor_lists_expanded">[docs]</a>    <span class="k">def</span> <span class="nf">neighbor_lists_expanded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the cutoffs have been expanded.</span>
<span class="sd">                    </span>
<span class="sd">        If the cutoffs have been made longer than before,</span>
<span class="sd">        the neighbor lists have to be recalculated.</span>
<span class="sd">        This method checks the individual cutoffs of all atoms</span>
<span class="sd">        to check if the cutoffs have changed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        cutoffs: list of doubles</span>
<span class="sd">            new cutoffs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_cutoffs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">cutoffs</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
                                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_cutoffs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">old_cut</span><span class="p">,</span> <span class="n">new_cut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_cutoffs</span><span class="p">,</span> <span class="n">cutoffs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">old_cut</span> <span class="o">&lt;</span> <span class="n">new_cut</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
                
        <span class="k">return</span> <span class="bp">False</span>

            

</div>
<div class="viewcode-block" id="Pysic.get_numerical_bond_order_gradient"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_numerical_bond_order_gradient">[docs]</a>    <span class="k">def</span> <span class="nf">get_numerical_bond_order_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinator</span><span class="p">,</span> <span class="n">atom_index</span><span class="p">,</span> <span class="n">moved_index</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Numerically calculates the gradient of a bond order factor with respect to moving a single particle.</span>

<span class="sd">        This is for debugging the bond orders.&quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">atoms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="n">crd</span> <span class="o">=</span> <span class="n">coordinator</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_xp</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_xm</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">shift</span>        

        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_yp</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_ym</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">shift</span>

        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_zp</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">crd</span><span class="o">.</span><span class="n">calculate_bond_order_factors</span><span class="p">()</span>
        <span class="n">bond_zm</span> <span class="o">=</span> <span class="n">crd</span><span class="o">.</span><span class="n">get_bond_order_factors</span><span class="p">()[</span><span class="n">atom_index</span><span class="p">]</span>
        <span class="n">system</span><span class="p">[</span><span class="n">moved_index</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">orig_system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>

        
        <span class="k">return</span> <span class="p">[</span> <span class="p">(</span><span class="n">bond_xp</span><span class="o">-</span><span class="n">bond_xm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">bond_yp</span><span class="o">-</span><span class="n">bond_ym</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">bond_zp</span><span class="o">-</span><span class="n">bond_zm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">)</span> <span class="p">]</span>



    </div>
<div class="viewcode-block" id="Pysic.get_numerical_electronegativity"><a class="viewcode-back" href="../pysic class.html#pysic.Pysic.get_numerical_electronegativity">[docs]</a>    <span class="k">def</span> <span class="nf">get_numerical_electronegativity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_index</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Numerically calculates the derivative of energy with respect to charging a single particle.</span>
<span class="sd">            </span>
<span class="sd">            This is for debugging the electronegativities.&quot;&quot;&quot;</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">atoms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">orig_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">charges</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_charges</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        <span class="n">charges</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">system</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
        <span class="n">energy_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">charges</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">system</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
        <span class="n">energy_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">charges</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">shift</span>
        <span class="n">system</span><span class="o">.</span><span class="n">set_charges</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_atoms</span><span class="p">(</span><span class="n">orig_system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_core</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">energy_m</span><span class="o">-</span><span class="n">energy_p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">shift</span><span class="p">)</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Pysic 0.4.3 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Teemu Hynninen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>